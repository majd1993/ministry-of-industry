{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = clockSkewAdjustment;\n\nvar _incomingActivity = require(\"../actions/incomingActivity\");\n\nvar _setClockSkewAdjustment = require(\"../actions/setClockSkewAdjustment\");\n\nfunction clockSkewAdjustment() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n\n  var _ref = arguments.length > 1 ? arguments[1] : undefined,\n      payload = _ref.payload,\n      type = _ref.type;\n\n  if (type === _incomingActivity.INCOMING_ACTIVITY) {\n    var _payload$activity = payload.activity,\n        _payload$activity$cha = _payload$activity.channelData;\n    _payload$activity$cha = _payload$activity$cha === void 0 ? {} : _payload$activity$cha;\n    var clientTimestamp = _payload$activity$cha.clientTimestamp,\n        timestamp = _payload$activity.timestamp;\n    var clientSendTime = Date.parse(clientTimestamp);\n    var serverTime = Date.parse(timestamp);\n\n    if (!isNaN(clientSendTime) && !isNaN(serverTime)) {\n      // The adjustment include the latency between the client and the server.\n      // This means, the adjustment is always larger than the actual value.\n      // And it means, after adjustment, client time will be ahead of server time.\n      // And it also means, the user-originated message has higher probability to appear below bot-originated message.\n      // Although it has higher probability, if the user-originated message is still sending (i.e. did not echoback with server timestamp yet),\n      // the insertion-sort logic will put the bot-originated below the user-originated message.\n      state = serverTime - clientSendTime;\n    }\n  } else if (type === _setClockSkewAdjustment.SET_CLOCK_SKEW_ADJUSTMENT) {\n    // Currently, this action is for testing purpose only.\n    state = payload.value;\n  }\n\n  return state;\n}","map":{"version":3,"sources":["../../src/reducers/clockSkewAdjustment.js"],"names":["state","payload","type","INCOMING_ACTIVITY","clientTimestamp","timestamp","clientSendTime","Date","serverTime","isNaN","SET_CLOCK_SKEW_ADJUSTMENT"],"mappings":";;;;;;;AAAA,IAAA,iBAAA,GAAA,OAAA,CAAA,6BAAA,CAAA;;AACA,IAAA,uBAAA,GAAA,OAAA,CAAA,mCAAA,CAAA;;AAEe,SAAA,mBAAA,GAA2D;AAAA,MAA9BA,KAA8B,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,IAAA,SAAA,CAAA,CAAA,CAAA,KAAA,SAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAtB,CAAsB;;AAAA,MAAA,IAAA,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAA,SAAA;AAAA,MAAjBC,OAAiB,GAAA,IAAA,CAAjBA,OAAiB;AAAA,MAARC,IAAQ,GAAA,IAAA,CAARA,IAAQ;;AACxE,MAAIA,IAAI,KAAKC,iBAAAA,CAAb,iBAAA,EAAgC;AAAA,QAAA,iBAAA,GAG1BF,OAH0B,CAAA,QAAA;AAAA,QAAA,qBAAA,GAAA,iBAAA,CAAA,WAAA;AAAA,IAAA,qBAAA,GAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,qBAAA;AAAA,QAEDG,eAFC,GAAA,qBAAA,CAAA,eAAA;AAAA,QAEuBC,SAFvB,GAAA,iBAAA,CAAA,SAAA;AAK9B,QAAMC,cAAc,GAAGC,IAAI,CAAJA,KAAAA,CAAvB,eAAuBA,CAAvB;AACA,QAAMC,UAAU,GAAGD,IAAI,CAAJA,KAAAA,CAAnB,SAAmBA,CAAnB;;AAEA,QAAI,CAACE,KAAK,CAAN,cAAM,CAAN,IAA0B,CAACA,KAAK,CAApC,UAAoC,CAApC,EAAkD;AAChD;AACA;AACA;AACA;AACA;AACA;AAEAT,MAAAA,KAAK,GAAGQ,UAAU,GAAlBR,cAAAA;AACD;AAjBH,GAAA,MAkBO,IAAIE,IAAI,KAAKQ,uBAAAA,CAAb,yBAAA,EAAwC;AAC7C;AACAV,IAAAA,KAAK,GAAGC,OAAO,CAAfD,KAAAA;AACD;;AAED,SAAA,KAAA;AACD","sourcesContent":["import { INCOMING_ACTIVITY } from '../actions/incomingActivity';\nimport { SET_CLOCK_SKEW_ADJUSTMENT } from '../actions/setClockSkewAdjustment';\n\nexport default function clockSkewAdjustment(state = 0, { payload, type }) {\n  if (type === INCOMING_ACTIVITY) {\n    const {\n      activity: { channelData: { clientTimestamp } = {}, timestamp }\n    } = payload;\n\n    const clientSendTime = Date.parse(clientTimestamp);\n    const serverTime = Date.parse(timestamp);\n\n    if (!isNaN(clientSendTime) && !isNaN(serverTime)) {\n      // The adjustment include the latency between the client and the server.\n      // This means, the adjustment is always larger than the actual value.\n      // And it means, after adjustment, client time will be ahead of server time.\n      // And it also means, the user-originated message has higher probability to appear below bot-originated message.\n      // Although it has higher probability, if the user-originated message is still sending (i.e. did not echoback with server timestamp yet),\n      // the insertion-sort logic will put the bot-originated below the user-originated message.\n\n      state = serverTime - clientSendTime;\n    }\n  } else if (type === SET_CLOCK_SKEW_ADJUSTMENT) {\n    // Currently, this action is for testing purpose only.\n    state = payload.value;\n  }\n\n  return state;\n}\n"],"sourceRoot":"core:///"},"metadata":{},"sourceType":"script"}