{"ast":null,"code":"import _classCallCheck from \"/home/Ubility/Desktop/ministry-of-industry-and-advanced-technology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/Ubility/Desktop/ministry-of-industry-and-advanced-technology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\nimport { AudioOutputFormatImpl } from \"../sdk/Audio/AudioOutputFormat\";\nimport { AudioOutputStream } from \"../sdk/Audio/AudioOutputStream\";\nimport { MessageDataStreamType } from \"./ServiceMessages/ActivityResponsePayload\";\nexport var DialogServiceTurnState = /*#__PURE__*/function () {\n  function DialogServiceTurnState(manager, requestId) {\n    _classCallCheck(this, DialogServiceTurnState);\n\n    this.privRequestId = requestId;\n    this.privIsCompleted = false;\n    this.privAudioStream = null;\n    this.privTurnManager = manager;\n    this.resetTurnEndTimeout(); // tslint:disable-next-line:no-console\n    // console.info(\"DialogServiceTurnState debugturn start:\" + this.privRequestId);\n  }\n\n  _createClass(DialogServiceTurnState, [{\n    key: \"audioStream\",\n    get: function get() {\n      // Called when is needed to stream.\n      this.resetTurnEndTimeout();\n      return this.privAudioStream;\n    }\n  }, {\n    key: \"processActivityPayload\",\n    value: function processActivityPayload(payload, audioFormat) {\n      if (payload.messageDataStreamType === MessageDataStreamType.TextToSpeechAudio) {\n        this.privAudioStream = AudioOutputStream.createPullStream();\n        this.privAudioStream.format = audioFormat !== undefined ? audioFormat : AudioOutputFormatImpl.getDefaultOutputFormat(); // tslint:disable-next-line:no-console\n        // console.info(\"Audio start debugturn:\" + this.privRequestId);\n      }\n\n      return this.privAudioStream;\n    }\n  }, {\n    key: \"endAudioStream\",\n    value: function endAudioStream() {\n      if (this.privAudioStream !== null && !this.privAudioStream.isClosed) {\n        this.privAudioStream.close();\n      }\n    }\n  }, {\n    key: \"complete\",\n    value: function complete() {\n      if (this.privTimeoutToken !== undefined) {\n        clearTimeout(this.privTimeoutToken);\n      }\n\n      this.endAudioStream();\n    }\n  }, {\n    key: \"resetTurnEndTimeout\",\n    value: function resetTurnEndTimeout() {\n      var _this = this;\n\n      if (this.privTimeoutToken !== undefined) {\n        clearTimeout(this.privTimeoutToken);\n      } // tslint:disable-next-line:no-console\n      // console.info(\"Timeout reset debugturn:\" + this.privRequestId);\n\n\n      this.privTimeoutToken = setTimeout(function () {\n        // tslint:disable-next-line:no-console\n        // console.info(\"Timeout complete debugturn:\" + this.privRequestId);\n        _this.privTurnManager.CompleteTurn(_this.privRequestId);\n\n        return;\n      }, 2000);\n    }\n  }]);\n\n  return DialogServiceTurnState;\n}();","map":{"version":3,"sources":["src/common.speech/DialogServiceTurnState.ts"],"names":[],"mappings":";;AAAA;AACA;AAEA,SAAS,qBAAT,QAAsC,gCAAtC;AACA,SAAS,iBAAT,QAA6D,gCAA7D;AAEA,SAAkC,qBAAlC,QAA+D,2CAA/D;AAEA,WAAa,sBAAb;AAOI,kCAAY,OAAZ,EAAoD,SAApD,EAAqE;AAAA;;AACjE,SAAK,aAAL,GAAqB,SAArB;AACA,SAAK,eAAL,GAAuB,KAAvB;AACA,SAAK,eAAL,GAAuB,IAAvB;AACA,SAAK,eAAL,GAAuB,OAAvB;AACA,SAAK,mBAAL,GALiE,CAMjE;AACA;AACH;;AAfL;AAAA;AAAA,SAiBI,eAAsB;AAClB;AACA,WAAK,mBAAL;AACA,aAAO,KAAK,eAAZ;AACH;AArBL;AAAA;AAAA,WAuBW,gCAAuB,OAAvB,EAAyD,WAAzD,EAA4F;AAC/F,UAAI,OAAO,CAAC,qBAAR,KAAkC,qBAAqB,CAAC,iBAA5D,EAA+E;AAC3E,aAAK,eAAL,GAAuB,iBAAiB,CAAC,gBAAlB,EAAvB;AACA,aAAK,eAAL,CAAqB,MAArB,GAA+B,WAAW,KAAK,SAAjB,GAA8B,WAA9B,GAA4C,qBAAqB,CAAC,sBAAtB,EAA1E,CAF2E,CAG3E;AACA;AACH;;AACD,aAAO,KAAK,eAAZ;AACH;AA/BL;AAAA;AAAA,WAiCW,0BAAc;AACjB,UAAI,KAAK,eAAL,KAAyB,IAAzB,IAAiC,CAAC,KAAK,eAAL,CAAqB,QAA3D,EAAqE;AACjE,aAAK,eAAL,CAAqB,KAArB;AACH;AACJ;AArCL;AAAA;AAAA,WAuCW,oBAAQ;AACX,UAAI,KAAK,gBAAL,KAA0B,SAA9B,EAAyC;AACrC,QAAA,YAAY,CAAC,KAAK,gBAAN,CAAZ;AACH;;AACD,WAAK,cAAL;AACH;AA5CL;AAAA;AAAA,WA8CY,+BAAmB;AAAA;;AACvB,UAAI,KAAK,gBAAL,KAA0B,SAA9B,EAAyC;AACrC,QAAA,YAAY,CAAC,KAAK,gBAAN,CAAZ;AACH,OAHsB,CAIvB;AACA;;;AAEA,WAAK,gBAAL,GAAwB,UAAU,CAAC,YAAW;AAC1C;AACA;AAEA,QAAA,KAAI,CAAC,eAAL,CAAqB,YAArB,CAAkC,KAAI,CAAC,aAAvC;;AACA;AACH,OANiC,EAM/B,IAN+B,CAAlC;AAOH;AA5DL;;AAAA;AAAA","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { AudioOutputFormatImpl } from \"../sdk/Audio/AudioOutputFormat\";\r\nimport { AudioOutputStream, PullAudioOutputStreamImpl } from \"../sdk/Audio/AudioOutputStream\";\r\nimport { DialogServiceTurnStateManager } from \"./DialogServiceTurnStateManager\";\r\nimport { ActivityPayloadResponse, MessageDataStreamType } from \"./ServiceMessages/ActivityResponsePayload\";\r\n\r\nexport class DialogServiceTurnState {\r\n    private privRequestId: string;\r\n    private privIsCompleted: boolean;\r\n    private privAudioStream: PullAudioOutputStreamImpl;\r\n    private privTimeoutToken: any;\r\n    private privTurnManager: DialogServiceTurnStateManager;\r\n\r\n    constructor(manager: DialogServiceTurnStateManager, requestId: string) {\r\n        this.privRequestId = requestId;\r\n        this.privIsCompleted = false;\r\n        this.privAudioStream = null;\r\n        this.privTurnManager = manager;\r\n        this.resetTurnEndTimeout();\r\n        // tslint:disable-next-line:no-console\r\n        // console.info(\"DialogServiceTurnState debugturn start:\" + this.privRequestId);\r\n    }\r\n\r\n    public get audioStream(): PullAudioOutputStreamImpl {\r\n        // Called when is needed to stream.\r\n        this.resetTurnEndTimeout();\r\n        return this.privAudioStream;\r\n    }\r\n\r\n    public processActivityPayload(payload: ActivityPayloadResponse, audioFormat?: AudioOutputFormatImpl): PullAudioOutputStreamImpl {\r\n        if (payload.messageDataStreamType === MessageDataStreamType.TextToSpeechAudio) {\r\n            this.privAudioStream = AudioOutputStream.createPullStream() as PullAudioOutputStreamImpl;\r\n            this.privAudioStream.format = (audioFormat !== undefined) ? audioFormat : AudioOutputFormatImpl.getDefaultOutputFormat();\r\n            // tslint:disable-next-line:no-console\r\n            // console.info(\"Audio start debugturn:\" + this.privRequestId);\r\n        }\r\n        return this.privAudioStream;\r\n    }\r\n\r\n    public endAudioStream(): void {\r\n        if (this.privAudioStream !== null && !this.privAudioStream.isClosed) {\r\n            this.privAudioStream.close();\r\n        }\r\n    }\r\n\r\n    public complete(): void {\r\n        if (this.privTimeoutToken !== undefined) {\r\n            clearTimeout(this.privTimeoutToken);\r\n        }\r\n        this.endAudioStream();\r\n    }\r\n\r\n    private resetTurnEndTimeout(): void {\r\n        if (this.privTimeoutToken !== undefined) {\r\n            clearTimeout(this.privTimeoutToken);\r\n        }\r\n        // tslint:disable-next-line:no-console\r\n        // console.info(\"Timeout reset debugturn:\" + this.privRequestId);\r\n\r\n        this.privTimeoutToken = setTimeout((): void => {\r\n            // tslint:disable-next-line:no-console\r\n            // console.info(\"Timeout complete debugturn:\" + this.privRequestId);\r\n\r\n            this.privTurnManager.CompleteTurn(this.privRequestId);\r\n            return;\r\n        }, 2000);\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}