{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/home/Ubility/Desktop/ministry-of-industry-and-advanced-technology/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = useSendFiles;\n\nvar _botframeworkWebchatApi = require(\"botframework-webchat-api\");\n\nvar _react = require(\"react\");\n\nvar _index = _interopRequireDefault(require(\"../Utils/downscaleImageToDataURL/index\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nvar useAPISendFiles = _botframeworkWebchatApi.hooks.useSendFiles,\n    useStyleOptions = _botframeworkWebchatApi.hooks.useStyleOptions,\n    useTrackTiming = _botframeworkWebchatApi.hooks.useTrackTiming;\n\nfunction canMakeThumbnail(_ref) {\n  var name = _ref.name;\n  return /\\.(gif|jpe?g|png)$/i.test(name);\n}\n\nfunction makeThumbnail(_x, _x2, _x3, _x4, _x5) {\n  return _makeThumbnail.apply(this, arguments);\n}\n\nfunction _makeThumbnail() {\n  _makeThumbnail = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file, width, height, contentType, quality) {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return (0, _index.default)(file, width, height, contentType, quality);\n\n          case 3:\n            return _context3.abrupt(\"return\", _context3.sent);\n\n          case 6:\n            _context3.prev = 6;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.warn(\"Web Chat: Failed to downscale image due to \".concat(_context3.t0, \".\"));\n\n          case 9:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[0, 6]]);\n  }));\n  return _makeThumbnail.apply(this, arguments);\n}\n\nfunction useSendFiles() {\n  var sendFiles = useAPISendFiles();\n\n  var _useStyleOptions = useStyleOptions(),\n      _useStyleOptions2 = _slicedToArray(_useStyleOptions, 1),\n      _useStyleOptions2$ = _useStyleOptions2[0],\n      enableUploadThumbnail = _useStyleOptions2$.enableUploadThumbnail,\n      uploadThumbnailContentType = _useStyleOptions2$.uploadThumbnailContentType,\n      uploadThumbnailHeight = _useStyleOptions2$.uploadThumbnailHeight,\n      uploadThumbnailQuality = _useStyleOptions2$.uploadThumbnailQuality,\n      uploadThumbnailWidth = _useStyleOptions2$.uploadThumbnailWidth;\n\n  var trackTiming = useTrackTiming();\n  return (0, _react.useCallback)( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(files) {\n      var attachments;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(files && files.length)) {\n                _context2.next = 6;\n                break;\n              }\n\n              files = [].slice.call(files); // TODO: [P3] We need to find revokeObjectURL on the UI side\n              //       Redux store should not know about the browser environment\n              //       One fix is to use ArrayBuffer instead of object URL, but that would requires change to DirectLineJS\n\n              _context2.next = 4;\n              return Promise.all([].map.call(files, /*#__PURE__*/function () {\n                var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(file) {\n                  var thumbnail;\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          if (!(_index.default && enableUploadThumbnail && canMakeThumbnail(file))) {\n                            _context.next = 4;\n                            break;\n                          }\n\n                          _context.next = 3;\n                          return trackTiming('sendFiles:makeThumbnail', makeThumbnail(file, uploadThumbnailWidth, uploadThumbnailHeight, uploadThumbnailContentType, uploadThumbnailQuality));\n\n                        case 3:\n                          thumbnail = _context.sent;\n\n                        case 4:\n                          return _context.abrupt(\"return\", _objectSpread({\n                            name: file.name,\n                            size: file.size,\n                            url: window.URL.createObjectURL(file)\n                          }, thumbnail && {\n                            thumbnail: thumbnail\n                          }));\n\n                        case 5:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function (_x7) {\n                  return _ref3.apply(this, arguments);\n                };\n              }()));\n\n            case 4:\n              attachments = _context2.sent;\n              sendFiles(attachments);\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x6) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [enableUploadThumbnail, sendFiles, trackTiming, uploadThumbnailContentType, uploadThumbnailHeight, uploadThumbnailQuality, uploadThumbnailWidth]);\n}","map":{"version":3,"sources":["../../src/hooks/useSendFiles.js"],"names":["useSendFiles","useAPISendFiles","useStyleOptions","useTrackTiming","hooks","name","makeThumbnail","console","sendFiles","enableUploadThumbnail","uploadThumbnailContentType","uploadThumbnailHeight","uploadThumbnailQuality","uploadThumbnailWidth","trackTiming","files","attachments","downscaleImageToDataURL","canMakeThumbnail","thumbnail","file","size","url","window"],"mappings":"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","sourcesContent":["/* eslint no-magic-numbers: [\"error\", { \"ignore\": [0, 1024] }] */\n\nimport { hooks } from 'botframework-webchat-api';\nimport { useCallback } from 'react';\n\nimport downscaleImageToDataURL from '../Utils/downscaleImageToDataURL/index';\n\nconst { useSendFiles: useAPISendFiles, useStyleOptions, useTrackTiming } = hooks;\n\nfunction canMakeThumbnail({ name }) {\n  return /\\.(gif|jpe?g|png)$/iu.test(name);\n}\n\nasync function makeThumbnail(file, width, height, contentType, quality) {\n  try {\n    return await downscaleImageToDataURL(file, width, height, contentType, quality);\n  } catch (error) {\n    console.warn(`Web Chat: Failed to downscale image due to ${error}.`);\n  }\n}\n\nexport default function useSendFiles() {\n  const sendFiles = useAPISendFiles();\n  const [\n    {\n      enableUploadThumbnail,\n      uploadThumbnailContentType,\n      uploadThumbnailHeight,\n      uploadThumbnailQuality,\n      uploadThumbnailWidth\n    }\n  ] = useStyleOptions();\n  const trackTiming = useTrackTiming();\n\n  return useCallback(\n    async files => {\n      if (files && files.length) {\n        files = [].slice.call(files);\n\n        // TODO: [P3] We need to find revokeObjectURL on the UI side\n        //       Redux store should not know about the browser environment\n        //       One fix is to use ArrayBuffer instead of object URL, but that would requires change to DirectLineJS\n        const attachments = await Promise.all(\n          [].map.call(files, async file => {\n            let thumbnail;\n\n            if (downscaleImageToDataURL && enableUploadThumbnail && canMakeThumbnail(file)) {\n              thumbnail = await trackTiming(\n                'sendFiles:makeThumbnail',\n                makeThumbnail(\n                  file,\n                  uploadThumbnailWidth,\n                  uploadThumbnailHeight,\n                  uploadThumbnailContentType,\n                  uploadThumbnailQuality\n                )\n              );\n            }\n\n            return {\n              name: file.name,\n              size: file.size,\n              url: window.URL.createObjectURL(file),\n              ...(thumbnail && { thumbnail })\n            };\n          })\n        );\n\n        sendFiles(attachments);\n      }\n    },\n    [\n      enableUploadThumbnail,\n      sendFiles,\n      trackTiming,\n      uploadThumbnailContentType,\n      uploadThumbnailHeight,\n      uploadThumbnailQuality,\n      uploadThumbnailWidth\n    ]\n  );\n}\n"],"sourceRoot":"component:///"},"metadata":{},"sourceType":"script"}