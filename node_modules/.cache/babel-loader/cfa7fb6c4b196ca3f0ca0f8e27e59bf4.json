{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * @module botframework-streaming\n */\n\n/**\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nvar subscribableStream_1 = require(\"../subscribableStream\");\n\nvar payloads_1 = require(\"../payloads\");\n\nvar contentStream_1 = require(\"../contentStream\");\n/**\n * Assembles payloads for streaming library.\n */\n\n\nvar PayloadAssembler =\n/** @class */\nfunction () {\n  function PayloadAssembler(streamManager, params) {\n    this._byteOrderMark = 0xFEFF;\n    this._utf = 'utf8';\n\n    if (params.header) {\n      this.id = params.header.id;\n      this.payloadType = params.header.payloadType;\n      this.contentLength = params.header.payloadLength;\n      this.end = params.header.end;\n    } else {\n      this.id = params.id;\n    }\n\n    if (!this.id) {\n      throw Error('An ID must be supplied when creating an assembler.');\n    }\n\n    this._streamManager = streamManager;\n    this._onCompleted = params.onCompleted;\n  }\n\n  PayloadAssembler.prototype.getPayloadStream = function () {\n    if (!this.stream) {\n      this.stream = this.createPayloadStream();\n    }\n\n    return this.stream;\n  };\n\n  PayloadAssembler.prototype.onReceive = function (header, stream, contentLength) {\n    this.end = header.end;\n\n    if (header.payloadType === payloads_1.PayloadTypes.response || header.payloadType === payloads_1.PayloadTypes.request) {\n      this.process(stream).then().catch();\n    } else if (header.end) {\n      stream.end();\n    }\n  };\n\n  PayloadAssembler.prototype.close = function () {\n    this._streamManager.closeStream(this.id);\n  };\n\n  PayloadAssembler.prototype.createPayloadStream = function () {\n    return new subscribableStream_1.SubscribableStream();\n  };\n\n  PayloadAssembler.prototype.payloadFromJson = function (json) {\n    return JSON.parse(json.charCodeAt(0) === this._byteOrderMark ? json.slice(1) : json);\n  };\n\n  PayloadAssembler.prototype.stripBOM = function (input) {\n    return input.charCodeAt(0) === this._byteOrderMark ? input.slice(1) : input;\n  };\n\n  PayloadAssembler.prototype.process = function (stream) {\n    return __awaiter(this, void 0, void 0, function () {\n      var streamData, streamDataAsString;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            streamData = stream.read(stream.length);\n\n            if (!streamData) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            streamDataAsString = streamData.toString(this._utf);\n            if (!(this.payloadType === payloads_1.PayloadTypes.request)) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.processRequest(streamDataAsString)];\n\n          case 1:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 4];\n\n          case 2:\n            if (!(this.payloadType === payloads_1.PayloadTypes.response)) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , this.processResponse(streamDataAsString)];\n\n          case 3:\n            _a.sent();\n\n            _a.label = 4;\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  PayloadAssembler.prototype.processResponse = function (streamDataAsString) {\n    return __awaiter(this, void 0, void 0, function () {\n      var responsePayload, receiveResponse;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            responsePayload = this.payloadFromJson(this.stripBOM(streamDataAsString));\n            receiveResponse = {\n              streams: [],\n              statusCode: responsePayload.statusCode\n            };\n            return [4\n            /*yield*/\n            , this.processStreams(responsePayload, receiveResponse)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  PayloadAssembler.prototype.processRequest = function (streamDataAsString) {\n    return __awaiter(this, void 0, void 0, function () {\n      var requestPayload, receiveRequest;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            requestPayload = this.payloadFromJson(streamDataAsString);\n            receiveRequest = {\n              streams: [],\n              path: requestPayload.path,\n              verb: requestPayload.verb\n            };\n            return [4\n            /*yield*/\n            , this.processStreams(requestPayload, receiveRequest)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  PayloadAssembler.prototype.processStreams = function (responsePayload, receiveResponse) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (responsePayload.streams) {\n              responsePayload.streams.forEach(function (responseStream) {\n                var contentAssembler = _this._streamManager.getPayloadAssembler(responseStream.id);\n\n                contentAssembler.payloadType = responseStream.contentType;\n                contentAssembler.contentLength = responseStream.length;\n                receiveResponse.streams.push(new contentStream_1.ContentStream(responseStream.id, contentAssembler));\n              });\n            }\n\n            return [4\n            /*yield*/\n            , this._onCompleted(this.id, receiveResponse)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return PayloadAssembler;\n}();\n\nexports.PayloadAssembler = PayloadAssembler;","map":{"version":3,"sources":["../../src/assemblers/payloadAssembler.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * @module botframework-streaming\n */\n/**\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\nvar subscribableStream_1 = require(\"../subscribableStream\");\nvar payloads_1 = require(\"../payloads\");\nvar contentStream_1 = require(\"../contentStream\");\n/**\n * Assembles payloads for streaming library.\n */\nvar PayloadAssembler = /** @class */ (function () {\n    function PayloadAssembler(streamManager, params) {\n        this._byteOrderMark = 0xFEFF;\n        this._utf = 'utf8';\n        if (params.header) {\n            this.id = params.header.id;\n            this.payloadType = params.header.payloadType;\n            this.contentLength = params.header.payloadLength;\n            this.end = params.header.end;\n        }\n        else {\n            this.id = params.id;\n        }\n        if (!this.id) {\n            throw Error('An ID must be supplied when creating an assembler.');\n        }\n        this._streamManager = streamManager;\n        this._onCompleted = params.onCompleted;\n    }\n    PayloadAssembler.prototype.getPayloadStream = function () {\n        if (!this.stream) {\n            this.stream = this.createPayloadStream();\n        }\n        return this.stream;\n    };\n    PayloadAssembler.prototype.onReceive = function (header, stream, contentLength) {\n        this.end = header.end;\n        if (header.payloadType === payloads_1.PayloadTypes.response || header.payloadType === payloads_1.PayloadTypes.request) {\n            this.process(stream)\n                .then()\n                .catch();\n        }\n        else if (header.end) {\n            stream.end();\n        }\n    };\n    PayloadAssembler.prototype.close = function () {\n        this._streamManager.closeStream(this.id);\n    };\n    PayloadAssembler.prototype.createPayloadStream = function () {\n        return new subscribableStream_1.SubscribableStream();\n    };\n    PayloadAssembler.prototype.payloadFromJson = function (json) {\n        return JSON.parse((json.charCodeAt(0) === this._byteOrderMark) ? json.slice(1) : json);\n    };\n    PayloadAssembler.prototype.stripBOM = function (input) {\n        return (input.charCodeAt(0) === this._byteOrderMark) ? input.slice(1) : input;\n    };\n    PayloadAssembler.prototype.process = function (stream) {\n        return __awaiter(this, void 0, void 0, function () {\n            var streamData, streamDataAsString;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        streamData = stream.read(stream.length);\n                        if (!streamData) {\n                            return [2 /*return*/];\n                        }\n                        streamDataAsString = streamData.toString(this._utf);\n                        if (!(this.payloadType === payloads_1.PayloadTypes.request)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.processRequest(streamDataAsString)];\n                    case 1:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 2:\n                        if (!(this.payloadType === payloads_1.PayloadTypes.response)) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.processResponse(streamDataAsString)];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PayloadAssembler.prototype.processResponse = function (streamDataAsString) {\n        return __awaiter(this, void 0, void 0, function () {\n            var responsePayload, receiveResponse;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        responsePayload = this.payloadFromJson(this.stripBOM(streamDataAsString));\n                        receiveResponse = { streams: [], statusCode: responsePayload.statusCode };\n                        return [4 /*yield*/, this.processStreams(responsePayload, receiveResponse)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PayloadAssembler.prototype.processRequest = function (streamDataAsString) {\n        return __awaiter(this, void 0, void 0, function () {\n            var requestPayload, receiveRequest;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        requestPayload = this.payloadFromJson(streamDataAsString);\n                        receiveRequest = { streams: [], path: requestPayload.path, verb: requestPayload.verb };\n                        return [4 /*yield*/, this.processStreams(requestPayload, receiveRequest)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PayloadAssembler.prototype.processStreams = function (responsePayload, receiveResponse) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (responsePayload.streams) {\n                            responsePayload.streams.forEach(function (responseStream) {\n                                var contentAssembler = _this._streamManager.getPayloadAssembler(responseStream.id);\n                                contentAssembler.payloadType = responseStream.contentType;\n                                contentAssembler.contentLength = responseStream.length;\n                                receiveResponse.streams.push(new contentStream_1.ContentStream(responseStream.id, contentAssembler));\n                            });\n                        }\n                        return [4 /*yield*/, this._onCompleted(this.id, receiveResponse)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return PayloadAssembler;\n}());\nexports.PayloadAssembler = PayloadAssembler;\n//# sourceMappingURL=payloadAssembler.js.map"]},"metadata":{},"sourceType":"script"}