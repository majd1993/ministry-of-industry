{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = _default;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _base64Arraybuffer = require(\"base64-arraybuffer\");\n\nvar _buildSSML = _interopRequireDefault(require(\"./buildSSML\"));\n\nvar _isSSML = _interopRequireDefault(require(\"./isSSML\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar DEFAULT_LANGUAGE = 'en-US';\nvar DEFAULT_OUTPUT_FORMAT = 'riff-16khz-16bit-mono-pcm';\nvar DEFAULT_VOICE = 'Microsoft Server Speech Text to Speech Voice (en-US, Aria24kRUS)';\nvar EMPTY_MP3_BASE64 = 'SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjU2LjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjY0AAAAAAAAAAAAAAAAJAUHAAAAAAAAAYYoRBqpAAAAAAD/+xDEAAPAAAGkAAAAIAAANIAAAARMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMQpg8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';\n\nfunction _default(_x) {\n  return _ref2.apply(this, arguments);\n}\n\nfunction _ref2() {\n  _ref2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(_ref) {\n    var deploymentId, fetchCredentials, _ref$lang, lang, _ref$outputFormat, outputFormat, pitch, rate, text, _ref$voice, voice, volume, _yield$fetchCredentia, authorizationToken, region, speechSynthesisHostname, subscriptionKey, ssml, hostname, search, url, res;\n\n    return _regenerator.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            deploymentId = _ref.deploymentId, fetchCredentials = _ref.fetchCredentials, _ref$lang = _ref.lang, lang = _ref$lang === void 0 ? DEFAULT_LANGUAGE : _ref$lang, _ref$outputFormat = _ref.outputFormat, outputFormat = _ref$outputFormat === void 0 ? DEFAULT_OUTPUT_FORMAT : _ref$outputFormat, pitch = _ref.pitch, rate = _ref.rate, text = _ref.text, _ref$voice = _ref.voice, voice = _ref$voice === void 0 ? DEFAULT_VOICE : _ref$voice, volume = _ref.volume;\n\n            if (text) {\n              _context.next = 3;\n              break;\n            }\n\n            return _context.abrupt(\"return\", (0, _base64Arraybuffer.decode)(EMPTY_MP3_BASE64));\n\n          case 3:\n            _context.next = 5;\n            return fetchCredentials();\n\n          case 5:\n            _yield$fetchCredentia = _context.sent;\n            authorizationToken = _yield$fetchCredentia.authorizationToken;\n            region = _yield$fetchCredentia.region;\n            speechSynthesisHostname = _yield$fetchCredentia.speechSynthesisHostname;\n            subscriptionKey = _yield$fetchCredentia.subscriptionKey;\n\n            if (!(authorizationToken && subscriptionKey || !authorizationToken && !subscriptionKey)) {\n              _context.next = 14;\n              break;\n            }\n\n            throw new Error('Only \"authorizationToken\" or \"subscriptionKey\" should be set.');\n\n          case 14:\n            if (!(region && speechSynthesisHostname || !region && !speechSynthesisHostname)) {\n              _context.next = 16;\n              break;\n            }\n\n            throw new Error('Only \"region\" or \"speechSynthesisHostnamename\" should be set.');\n\n          case 16:\n            ssml = (0, _isSSML.default)(text) ? text : (0, _buildSSML.default)({\n              lang: lang,\n              pitch: pitch,\n              rate: rate,\n              text: text,\n              voice: voice,\n              volume: volume\n            }); // Although calling encodeURI on hostname does not actually works, it fails faster and safer.\n\n            hostname = speechSynthesisHostname || (deploymentId ? \"\".concat(encodeURI(region), \".voice.speech.microsoft.com\") : \"\".concat(encodeURI(region), \".tts.speech.microsoft.com\"));\n            search = deploymentId ? \"?deploymentId=\".concat(encodeURI(deploymentId)) : '';\n            url = \"https://\".concat(hostname, \"/cognitiveservices/v1\").concat(search);\n            _context.next = 22;\n            return fetch(url, {\n              headers: _objectSpread({\n                'Content-Type': 'application/ssml+xml',\n                'X-Microsoft-OutputFormat': outputFormat\n              }, authorizationToken ? {\n                Authorization: \"Bearer \".concat(authorizationToken)\n              } : {\n                'Ocp-Apim-Subscription-Key': subscriptionKey\n              }),\n              method: 'POST',\n              body: ssml\n            });\n\n          case 22:\n            res = _context.sent;\n\n            if (res.ok) {\n              _context.next = 25;\n              break;\n            }\n\n            throw new Error(\"web-speech-cognitive-services: Failed to syntheis speech, server returned \".concat(res.status));\n\n          case 25:\n            return _context.abrupt(\"return\", res.arrayBuffer());\n\n          case 26:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _ref2.apply(this, arguments);\n}","map":{"version":3,"sources":["../../../src/SpeechServices/TextToSpeech/fetchSpeechData.js"],"names":["DEFAULT_LANGUAGE","DEFAULT_OUTPUT_FORMAT","DEFAULT_VOICE","EMPTY_MP3_BASE64","deploymentId","fetchCredentials","lang","outputFormat","pitch","rate","text","voice","volume","authorizationToken","region","speechSynthesisHostname","subscriptionKey","ssml","hostname","encodeURI","search","url","res","fetch","headers","Authorization","method","body"],"mappings":"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","sourcesContent":["import { decode } from 'base64-arraybuffer';\nimport buildSSML from './buildSSML';\nimport isSSML from './isSSML';\n\nconst DEFAULT_LANGUAGE = 'en-US';\nconst DEFAULT_OUTPUT_FORMAT = 'riff-16khz-16bit-mono-pcm';\nconst DEFAULT_VOICE = 'Microsoft Server Speech Text to Speech Voice (en-US, Aria24kRUS)';\nconst EMPTY_MP3_BASE64 =\n  'SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjU2LjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjY0AAAAAAAAAAAAAAAAJAUHAAAAAAAAAYYoRBqpAAAAAAD/+xDEAAPAAAGkAAAAIAAANIAAAARMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMQpg8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';\n\nexport default async function({\n  deploymentId,\n  fetchCredentials,\n  lang = DEFAULT_LANGUAGE,\n  outputFormat = DEFAULT_OUTPUT_FORMAT,\n  pitch,\n  rate,\n  text,\n  voice = DEFAULT_VOICE,\n  volume\n}) {\n  if (!text) {\n    // If text is empty, play a short audio clip. This allows developers to easily prime the AudioContext object by playing an empty string.\n    return decode(EMPTY_MP3_BASE64);\n  }\n\n  const { authorizationToken, region, speechSynthesisHostname, subscriptionKey } = await fetchCredentials();\n\n  if ((authorizationToken && subscriptionKey) || (!authorizationToken && !subscriptionKey)) {\n    throw new Error('Only \"authorizationToken\" or \"subscriptionKey\" should be set.');\n  } else if ((region && speechSynthesisHostname) || (!region && !speechSynthesisHostname)) {\n    throw new Error('Only \"region\" or \"speechSynthesisHostnamename\" should be set.');\n  }\n\n  const ssml = isSSML(text) ? text : buildSSML({ lang, pitch, rate, text, voice, volume });\n\n  // Although calling encodeURI on hostname does not actually works, it fails faster and safer.\n  const hostname =\n    speechSynthesisHostname ||\n    (deploymentId\n      ? `${ encodeURI(region) }.voice.speech.microsoft.com`\n      : `${ encodeURI(region) }.tts.speech.microsoft.com`);\n  const search = deploymentId ? `?deploymentId=${ encodeURI(deploymentId) }` : '';\n  const url = `https://${ hostname }/cognitiveservices/v1${ search }`;\n\n  const res = await fetch(url, {\n    headers: {\n      'Content-Type': 'application/ssml+xml',\n      'X-Microsoft-OutputFormat': outputFormat,\n      ...(authorizationToken\n        ? {\n            Authorization: `Bearer ${ authorizationToken }`\n          }\n        : {\n            'Ocp-Apim-Subscription-Key': subscriptionKey\n          })\n    },\n    method: 'POST',\n    body: ssml\n  });\n\n  if (!res.ok) {\n    throw new Error(`web-speech-cognitive-services: Failed to syntheis speech, server returned ${ res.status }`);\n  }\n\n  return res.arrayBuffer();\n}\n"]},"metadata":{},"sourceType":"script"}