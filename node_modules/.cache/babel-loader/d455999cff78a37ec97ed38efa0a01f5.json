{"ast":null,"code":"\"use strict\"; // Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Exports_1 = require(\"../../common.speech/Exports\");\n\nvar Contracts_1 = require(\"../../sdk/Contracts\");\n\nvar Exports_2 = require(\"../../sdk/Exports\");\n\nvar ConversationConnectionFactory_1 = require(\"./ConversationConnectionFactory\");\n\nvar ConversationServiceAdapter_1 = require(\"./ConversationServiceAdapter\");\n\nvar ConversationTranslatorInterfaces_1 = require(\"./ConversationTranslatorInterfaces\");\n\nvar ConversationUtils_1 = require(\"./ConversationUtils\");\n/**\n * Sends messages to the Conversation Translator websocket and listens for incoming events containing websocket messages.\n * Based off the recognizers in the SDK folder.\n */\n\n\nvar ConversationTranslatorRecognizer =\n/** @class */\nfunction (_super) {\n  __extends(ConversationTranslatorRecognizer, _super);\n\n  function ConversationTranslatorRecognizer(speechConfig, audioConfig) {\n    var _this = this;\n\n    var serviceConfigImpl = speechConfig;\n    Contracts_1.Contracts.throwIfNull(serviceConfigImpl, \"speechConfig\");\n    _this = _super.call(this, audioConfig, serviceConfigImpl.properties, new ConversationConnectionFactory_1.ConversationConnectionFactory()) || this;\n    _this.privIsDisposed = false;\n    _this.privProperties = serviceConfigImpl.properties.clone();\n    return _this;\n  }\n\n  Object.defineProperty(ConversationTranslatorRecognizer.prototype, \"conversation\", {\n    set: function set(value) {\n      this.privRoom = value;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ConversationTranslatorRecognizer.prototype, \"speechRecognitionLanguage\", {\n    /**\n     * Return the speech language used by the recognizer\n     */\n    get: function get() {\n      return this.privSpeechRecognitionLanguage;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ConversationTranslatorRecognizer.prototype, \"properties\", {\n    /**\n     * Return the properties for the recognizer\n     */\n    get: function get() {\n      return this.privProperties;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ConversationTranslatorRecognizer.prototype.isDisposed = function () {\n    return this.privIsDisposed;\n  };\n  /**\n   * Connect to the recognizer\n   * @param token\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.connect = function (token, cb, err) {\n    try {\n      Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n      Contracts_1.Contracts.throwIfNullOrWhitespace(token, \"token\");\n      this.privReco.conversationTranslatorToken = token;\n      this.privReco.connectAsync(cb, err);\n    } catch (error) {\n      if (!!err) {\n        if (error instanceof Error) {\n          var typedError = error;\n          err(typedError.name + \": \" + typedError.message);\n        } else {\n          err(error);\n        }\n      }\n    }\n  };\n  /**\n   * Disconnect from the recognizer\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.disconnect = function (cb, err) {\n    try {\n      Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n      this.privRoom = undefined;\n      this.privReco.disconnectAsync(cb, err);\n    } catch (error) {\n      if (!!err) {\n        if (error instanceof Error) {\n          var typedError = error;\n          err(typedError.name + \": \" + typedError.message);\n        } else {\n          err(error);\n        }\n      } // Destroy the recognizer.\n\n\n      this.dispose(true);\n    }\n  };\n  /**\n   * Send the text message command to the websocket\n   * @param conversationId\n   * @param participantId\n   * @param message\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.sendMessageRequest = function (message, cb, err) {\n    try {\n      Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId, \"participantId\");\n      Contracts_1.Contracts.throwIfNullOrWhitespace(message, \"message\");\n      var command = {\n        // tslint:disable-next-line: object-literal-shorthand\n        participantId: this.privRoom.participantId,\n        roomId: this.privRoom.roomId,\n        text: message,\n        type: ConversationTranslatorInterfaces_1.ConversationTranslatorMessageTypes.instantMessage\n      };\n      this.sendMessage(JSON.stringify(command), cb, err);\n    } catch (error) {\n      if (!!err) {\n        if (error instanceof Error) {\n          var typedError = error;\n          err(typedError.name + \": \" + typedError.message);\n        } else {\n          err(error);\n        }\n      } // Destroy the recognizer.\n\n\n      this.dispose(true);\n    }\n  };\n  /**\n   * Send the lock conversation command to the websocket\n   * @param conversationId\n   * @param participantId\n   * @param isLocked\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.sendLockRequest = function (isLocked, cb, err) {\n    try {\n      Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId, \"participantId\");\n      Contracts_1.Contracts.throwIfNullOrUndefined(isLocked, \"isLocked\");\n      var command = {\n        command: ConversationTranslatorInterfaces_1.ConversationTranslatorCommandTypes.setLockState,\n        // tslint:disable-next-line: object-literal-shorthand\n        participantId: this.privRoom.participantId,\n        roomid: this.privRoom.roomId,\n        type: ConversationTranslatorInterfaces_1.ConversationTranslatorMessageTypes.participantCommand,\n        value: isLocked\n      };\n      this.sendMessage(JSON.stringify(command), cb, err);\n    } catch (error) {\n      if (!!err) {\n        if (error instanceof Error) {\n          var typedError = error;\n          err(typedError.name + \": \" + typedError.message);\n        } else {\n          err(error);\n        }\n      } // Destroy the recognizer.\n\n\n      this.dispose(true);\n    }\n  };\n  /**\n   * Send the mute all participants command to the websocket\n   * @param conversationId\n   * @param participantId\n   * @param isMuted\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.sendMuteAllRequest = function (isMuted, cb, err) {\n    try {\n      Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId, \"participantId\");\n      Contracts_1.Contracts.throwIfNullOrUndefined(isMuted, \"isMuted\");\n      var command = {\n        command: ConversationTranslatorInterfaces_1.ConversationTranslatorCommandTypes.setMuteAll,\n        // tslint:disable-next-line: object-literal-shorthand\n        participantId: this.privRoom.participantId,\n        roomid: this.privRoom.roomId,\n        type: ConversationTranslatorInterfaces_1.ConversationTranslatorMessageTypes.participantCommand,\n        value: isMuted\n      };\n      this.sendMessage(JSON.stringify(command), cb, err);\n    } catch (error) {\n      if (!!err) {\n        if (error instanceof Error) {\n          var typedError = error;\n          err(typedError.name + \": \" + typedError.message);\n        } else {\n          err(error);\n        }\n      } // Destroy the recognizer.\n\n\n      this.dispose(true);\n    }\n  };\n  /**\n   * Send the mute participant command to the websocket\n   * @param conversationId\n   * @param participantId\n   * @param isMuted\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.sendMuteRequest = function (participantId, isMuted, cb, err) {\n    try {\n      Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\n      Contracts_1.Contracts.throwIfNullOrWhitespace(participantId, \"participantId\");\n      Contracts_1.Contracts.throwIfNullOrUndefined(isMuted, \"isMuted\");\n      var command = {\n        command: ConversationTranslatorInterfaces_1.ConversationTranslatorCommandTypes.setMute,\n        // tslint:disable-next-line: object-literal-shorthand\n        participantId: participantId,\n        roomid: this.privRoom.roomId,\n        type: ConversationTranslatorInterfaces_1.ConversationTranslatorMessageTypes.participantCommand,\n        value: isMuted\n      };\n      this.sendMessage(JSON.stringify(command), cb, err);\n    } catch (error) {\n      if (!!err) {\n        if (error instanceof Error) {\n          var typedError = error;\n          err(typedError.name + \": \" + typedError.message);\n        } else {\n          err(error);\n        }\n      } // Destroy the recognizer.\n\n\n      this.dispose(true);\n    }\n  };\n  /**\n   * Send the eject participant command to the websocket\n   * @param conversationId\n   * @param participantId\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.sendEjectRequest = function (participantId, cb, err) {\n    try {\n      Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\n      Contracts_1.Contracts.throwIfNullOrWhitespace(participantId, \"participantId\");\n      var command = {\n        command: ConversationTranslatorInterfaces_1.ConversationTranslatorCommandTypes.ejectParticipant,\n        // tslint:disable-next-line: object-literal-shorthand\n        participantId: participantId,\n        roomid: this.privRoom.roomId,\n        type: ConversationTranslatorInterfaces_1.ConversationTranslatorMessageTypes.participantCommand\n      };\n      this.sendMessage(JSON.stringify(command), cb, err);\n\n      if (!!cb) {\n        try {\n          cb();\n        } catch (e) {\n          if (!!err) {\n            err(e);\n          }\n        }\n      }\n    } catch (error) {\n      if (!!err) {\n        if (error instanceof Error) {\n          var typedError = error;\n          err(typedError.name + \": \" + typedError.message);\n        } else {\n          err(error);\n        }\n      } // Destroy the recognizer.\n\n\n      this.dispose(true);\n    }\n  };\n  /**\n   * Send the mute participant command to the websocket\n   * @param conversationId\n   * @param participantId\n   * @param isMuted\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.sendChangeNicknameRequest = function (nickname, cb, err) {\n    try {\n      Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n      Contracts_1.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\n      Contracts_1.Contracts.throwIfNullOrWhitespace(nickname, \"nickname\");\n      var command = {\n        command: ConversationTranslatorInterfaces_1.ConversationTranslatorCommandTypes.changeNickname,\n        nickname: nickname,\n        // tslint:disable-next-line: object-literal-shorthand\n        participantId: this.privRoom.participantId,\n        roomid: this.privRoom.roomId,\n        type: ConversationTranslatorInterfaces_1.ConversationTranslatorMessageTypes.participantCommand,\n        value: nickname\n      };\n      this.sendMessage(JSON.stringify(command), cb, err);\n    } catch (error) {\n      if (!!err) {\n        if (error instanceof Error) {\n          var typedError = error;\n          err(typedError.name + \": \" + typedError.message);\n        } else {\n          err(error);\n        }\n      } // Destroy the recognizer.\n\n\n      this.dispose(true);\n    }\n  };\n  /**\n   * Close and dispose the recognizer\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.close = function () {\n    Contracts_1.Contracts.throwIfDisposed(this.privIsDisposed);\n    this.dispose(true);\n  };\n  /**\n   * Dispose the recognizer\n   * @param disposing\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.dispose = function (disposing) {\n    if (this.privIsDisposed) {\n      return;\n    }\n\n    if (disposing) {\n      this.privIsDisposed = true;\n\n      _super.prototype.dispose.call(this, disposing);\n    }\n  };\n  /**\n   * Create the config for the recognizer\n   * @param speechConfig\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.createRecognizerConfig = function (speechConfig) {\n    return new Exports_1.RecognizerConfig(speechConfig, this.privProperties);\n  };\n  /**\n   * Create the service recognizer.\n   * The audio source is redundnant here but is required by the implementation.\n   * @param authentication\n   * @param connectionFactory\n   * @param audioConfig\n   * @param recognizerConfig\n   */\n\n\n  ConversationTranslatorRecognizer.prototype.createServiceRecognizer = function (authentication, connectionFactory, audioConfig, recognizerConfig) {\n    var audioSource = audioConfig;\n    return new ConversationServiceAdapter_1.ConversationServiceAdapter(authentication, connectionFactory, audioSource, recognizerConfig, this);\n  };\n\n  ConversationTranslatorRecognizer.prototype.sendMessage = function (msg, cb, err) {\n    var withAsync = this.privReco;\n    ConversationUtils_1.PromiseToEmptyCallback(withAsync.sendMessageAsync(msg), cb, err);\n  };\n\n  return ConversationTranslatorRecognizer;\n}(Exports_2.Recognizer);\n\nexports.ConversationTranslatorRecognizer = ConversationTranslatorRecognizer;","map":{"version":3,"sources":["src/common.speech/Transcription/ConversationTranslatorRecognizer.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport {\r\n    IAuthentication,\r\n    IConnectionFactory,\r\n    RecognizerConfig,\r\n    ServiceRecognizerBase,\r\n    SpeechServiceConfig\r\n} from \"../../common.speech/Exports\";\r\nimport { AudioConfigImpl } from \"../../sdk/Audio/AudioConfig\";\r\nimport { Contracts } from \"../../sdk/Contracts\";\r\nimport { AudioConfig,\r\n    ConversationExpirationEventArgs,\r\n    ConversationParticipantsChangedEventArgs,\r\n    ConversationTranslationCanceledEventArgs,\r\n    PropertyCollection,\r\n    Recognizer,\r\n    SessionEventArgs,\r\n    SpeechTranslationConfig} from \"../../sdk/Exports\";\r\nimport { SpeechTranslationConfigImpl } from \"../../sdk/SpeechTranslationConfig\";\r\nimport { Callback } from \"../../sdk/Transcription/IConversation\";\r\nimport { ConversationConnectionFactory } from \"./ConversationConnectionFactory\";\r\nimport { ConversationServiceAdapter } from \"./ConversationServiceAdapter\";\r\nimport {\r\n    ConversationReceivedTranslationEventArgs,\r\n    LockRoomEventArgs,\r\n    MuteAllEventArgs,\r\n    ParticipantAttributeEventArgs,\r\n    ParticipantEventArgs,\r\n    ParticipantsListEventArgs } from \"./ConversationTranslatorEventArgs\";\r\nimport {\r\n    ConversationTranslatorCommandTypes,\r\n    ConversationTranslatorMessageTypes,\r\n    IChangeNicknameCommand,\r\n    IConversationTranslatorRecognizer,\r\n    IEjectParticipantCommand,\r\n    IInstantMessageCommand,\r\n    IInternalConversation,\r\n    ILockConversationCommand,\r\n    IMuteAllCommand,\r\n    IMuteCommand} from \"./ConversationTranslatorInterfaces\";\r\nimport { PromiseToEmptyCallback } from \"./ConversationUtils\";\r\n\r\n/**\r\n * Sends messages to the Conversation Translator websocket and listens for incoming events containing websocket messages.\r\n * Based off the recognizers in the SDK folder.\r\n */\r\nexport class ConversationTranslatorRecognizer extends Recognizer implements IConversationTranslatorRecognizer {\r\n\r\n    private privIsDisposed: boolean;\r\n    private privSpeechRecognitionLanguage: string;\r\n    private privRoom: IInternalConversation;\r\n\r\n    public constructor(speechConfig: SpeechTranslationConfig, audioConfig?: AudioConfig) {\r\n        const serviceConfigImpl = speechConfig as SpeechTranslationConfigImpl;\r\n        Contracts.throwIfNull(serviceConfigImpl, \"speechConfig\");\r\n\r\n        super(audioConfig, serviceConfigImpl.properties, new ConversationConnectionFactory());\r\n\r\n        this.privIsDisposed = false;\r\n        this.privProperties = serviceConfigImpl.properties.clone();\r\n\r\n    }\r\n\r\n    public canceled: (sender: IConversationTranslatorRecognizer, event: ConversationTranslationCanceledEventArgs) => void;\r\n    public conversationExpiration: (sender: IConversationTranslatorRecognizer, event: ConversationExpirationEventArgs) => void;\r\n    public lockRoomCommandReceived: (sender: IConversationTranslatorRecognizer, event: LockRoomEventArgs) => void;\r\n    public muteAllCommandReceived: (sender: IConversationTranslatorRecognizer, event: MuteAllEventArgs) => void;\r\n    public participantJoinCommandReceived: (sender: IConversationTranslatorRecognizer, event: ParticipantEventArgs) => void;\r\n    public participantLeaveCommandReceived: (sender: IConversationTranslatorRecognizer, event: ParticipantEventArgs) => void;\r\n    public participantUpdateCommandReceived: (sender: IConversationTranslatorRecognizer, event: ParticipantAttributeEventArgs) => void;\r\n    public connectionOpened: (sender: IConversationTranslatorRecognizer, event: SessionEventArgs) => void;\r\n    public connectionClosed: (sender: IConversationTranslatorRecognizer, event: SessionEventArgs) => void;\r\n    public translationReceived: (sender: IConversationTranslatorRecognizer, event: ConversationReceivedTranslationEventArgs) => void;\r\n    public participantsListReceived: (sender: IConversationTranslatorRecognizer, event: ParticipantsListEventArgs) => void;\r\n    public participantsChanged: (sender: IConversationTranslatorRecognizer, event: ConversationParticipantsChangedEventArgs) => void;\r\n\r\n    public set conversation(value: IInternalConversation) {\r\n        this.privRoom = value;\r\n    }\r\n\r\n    /**\r\n     * Return the speech language used by the recognizer\r\n     */\r\n    public get speechRecognitionLanguage(): string {\r\n        return this.privSpeechRecognitionLanguage;\r\n    }\r\n\r\n    /**\r\n     * Return the properties for the recognizer\r\n     */\r\n    public get properties(): PropertyCollection {\r\n        return this.privProperties;\r\n    }\r\n\r\n    public isDisposed(): boolean {\r\n        return this.privIsDisposed;\r\n    }\r\n\r\n    /**\r\n     * Connect to the recognizer\r\n     * @param token\r\n     */\r\n    public connect(token: string, cb?: () => void, err?: (e: string) => void): void {\r\n        try {\r\n            Contracts.throwIfDisposed(this.privIsDisposed);\r\n            Contracts.throwIfNullOrWhitespace(token, \"token\");\r\n            this.privReco.conversationTranslatorToken = token;\r\n            this.privReco.connectAsync(cb, err);\r\n        } catch (error) {\r\n            if (!!err) {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disconnect from the recognizer\r\n     */\r\n    public disconnect(cb?: () => void, err?: (e: string) => void): void {\r\n        try {\r\n            Contracts.throwIfDisposed(this.privIsDisposed);\r\n            this.privRoom = undefined;\r\n            this.privReco.disconnectAsync(cb, err);\r\n        } catch (error) {\r\n            if (!!err) {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n            }\r\n            // Destroy the recognizer.\r\n            this.dispose(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send the text message command to the websocket\r\n     * @param conversationId\r\n     * @param participantId\r\n     * @param message\r\n     */\r\n    public sendMessageRequest(message: string, cb?: () => void, err?: (e: string) => void): void {\r\n        try {\r\n            Contracts.throwIfDisposed(this.privIsDisposed);\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.participantId, \"participantId\");\r\n            Contracts.throwIfNullOrWhitespace(message, \"message\");\r\n\r\n            const command: IInstantMessageCommand = {\r\n                // tslint:disable-next-line: object-literal-shorthand\r\n                participantId: this.privRoom.participantId,\r\n                roomId: this.privRoom.roomId,\r\n                text: message,\r\n                type: ConversationTranslatorMessageTypes.instantMessage\r\n            };\r\n\r\n            this.sendMessage(JSON.stringify(command), cb, err);\r\n\r\n        } catch (error) {\r\n            if (!!err) {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n            }\r\n\r\n            // Destroy the recognizer.\r\n            this.dispose(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send the lock conversation command to the websocket\r\n     * @param conversationId\r\n     * @param participantId\r\n     * @param isLocked\r\n     */\r\n    public sendLockRequest(isLocked: boolean, cb?: () => void, err?: (e: string) => void): void {\r\n\r\n        try {\r\n            Contracts.throwIfDisposed(this.privIsDisposed);\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.participantId, \"participantId\");\r\n            Contracts.throwIfNullOrUndefined(isLocked, \"isLocked\");\r\n\r\n            const command: ILockConversationCommand = {\r\n                command: ConversationTranslatorCommandTypes.setLockState,\r\n                // tslint:disable-next-line: object-literal-shorthand\r\n                participantId: this.privRoom.participantId,\r\n                roomid: this.privRoom.roomId,\r\n                type: ConversationTranslatorMessageTypes.participantCommand,\r\n                value: isLocked\r\n            };\r\n\r\n            this.sendMessage(JSON.stringify(command), cb, err);\r\n        } catch (error) {\r\n            if (!!err) {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n            }\r\n\r\n            // Destroy the recognizer.\r\n            this.dispose(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send the mute all participants command to the websocket\r\n     * @param conversationId\r\n     * @param participantId\r\n     * @param isMuted\r\n     */\r\n    public sendMuteAllRequest(isMuted: boolean, cb?: () => void, err?: (e: string) => void): void {\r\n\r\n        try {\r\n            Contracts.throwIfDisposed(this.privIsDisposed);\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.participantId, \"participantId\");\r\n            Contracts.throwIfNullOrUndefined(isMuted, \"isMuted\");\r\n\r\n            const command: IMuteAllCommand = {\r\n                command: ConversationTranslatorCommandTypes.setMuteAll,\r\n                // tslint:disable-next-line: object-literal-shorthand\r\n                participantId: this.privRoom.participantId, // the id of the host\r\n                roomid: this.privRoom.roomId,\r\n                type: ConversationTranslatorMessageTypes.participantCommand,\r\n                value: isMuted\r\n            };\r\n\r\n            this.sendMessage(JSON.stringify(command), cb, err);\r\n        } catch (error) {\r\n            if (!!err) {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n            }\r\n\r\n            // Destroy the recognizer.\r\n            this.dispose(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send the mute participant command to the websocket\r\n     * @param conversationId\r\n     * @param participantId\r\n     * @param isMuted\r\n     */\r\n    public sendMuteRequest(participantId: string, isMuted: boolean, cb?: () => void, err?: (e: string) => void): void {\r\n\r\n        try {\r\n            Contracts.throwIfDisposed(this.privIsDisposed);\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\r\n            Contracts.throwIfNullOrWhitespace(participantId, \"participantId\");\r\n            Contracts.throwIfNullOrUndefined(isMuted, \"isMuted\");\r\n\r\n            const command: IMuteCommand = {\r\n                command: ConversationTranslatorCommandTypes.setMute,\r\n                // tslint:disable-next-line: object-literal-shorthand\r\n                participantId: participantId, // the id of the participant\r\n                roomid: this.privRoom.roomId,\r\n                type: ConversationTranslatorMessageTypes.participantCommand,\r\n                value: isMuted\r\n            };\r\n\r\n            this.sendMessage(JSON.stringify(command), cb, err);\r\n        } catch (error) {\r\n            if (!!err) {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n            }\r\n\r\n            // Destroy the recognizer.\r\n            this.dispose(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send the eject participant command to the websocket\r\n     * @param conversationId\r\n     * @param participantId\r\n     */\r\n    public sendEjectRequest(participantId: string, cb?: () => void, err?: (e: string) => void): void {\r\n\r\n        try {\r\n            Contracts.throwIfDisposed(this.privIsDisposed);\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\r\n            Contracts.throwIfNullOrWhitespace(participantId, \"participantId\");\r\n\r\n            const command: IEjectParticipantCommand = {\r\n                command: ConversationTranslatorCommandTypes.ejectParticipant,\r\n                // tslint:disable-next-line: object-literal-shorthand\r\n                participantId: participantId,\r\n                roomid: this.privRoom.roomId,\r\n                type: ConversationTranslatorMessageTypes.participantCommand,\r\n            };\r\n\r\n            this.sendMessage(JSON.stringify(command), cb, err);\r\n\r\n            if (!!cb) {\r\n                try {\r\n                    cb();\r\n                } catch (e) {\r\n                    if (!!err) {\r\n                        err(e);\r\n                    }\r\n                }\r\n            }\r\n\r\n        } catch (error) {\r\n            if (!!err) {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n            }\r\n\r\n            // Destroy the recognizer.\r\n            this.dispose(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send the mute participant command to the websocket\r\n     * @param conversationId\r\n     * @param participantId\r\n     * @param isMuted\r\n     */\r\n    public sendChangeNicknameRequest(nickname: string, cb?: () => void, err?: (e: string) => void): void {\r\n\r\n        try {\r\n            Contracts.throwIfDisposed(this.privIsDisposed);\r\n            Contracts.throwIfNullOrWhitespace(this.privRoom.roomId, \"conversationId\");\r\n            Contracts.throwIfNullOrWhitespace(nickname, \"nickname\");\r\n\r\n            const command: IChangeNicknameCommand = {\r\n                command: ConversationTranslatorCommandTypes.changeNickname,\r\n                nickname,\r\n                // tslint:disable-next-line: object-literal-shorthand\r\n                participantId: this.privRoom.participantId, // the id of the host\r\n                roomid: this.privRoom.roomId,\r\n                type: ConversationTranslatorMessageTypes.participantCommand,\r\n                value: nickname\r\n            };\r\n\r\n            this.sendMessage(JSON.stringify(command), cb, err);\r\n\r\n        } catch (error) {\r\n            if (!!err) {\r\n                if (error instanceof Error) {\r\n                    const typedError: Error = error as Error;\r\n                    err(typedError.name + \": \" + typedError.message);\r\n                } else {\r\n                    err(error);\r\n                }\r\n            }\r\n\r\n            // Destroy the recognizer.\r\n            this.dispose(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Close and dispose the recognizer\r\n     */\r\n    public close(): void {\r\n        Contracts.throwIfDisposed(this.privIsDisposed);\r\n        this.dispose(true);\r\n    }\r\n\r\n    /**\r\n     * Dispose the recognizer\r\n     * @param disposing\r\n     */\r\n    protected dispose(disposing: boolean): boolean {\r\n        if (this.privIsDisposed) {\r\n            return;\r\n        }\r\n        if (disposing) {\r\n            this.privIsDisposed = true;\r\n            super.dispose(disposing);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create the config for the recognizer\r\n     * @param speechConfig\r\n     */\r\n    protected createRecognizerConfig(speechConfig: SpeechServiceConfig): RecognizerConfig {\r\n        return new RecognizerConfig(speechConfig, this.privProperties);\r\n    }\r\n\r\n    /**\r\n     * Create the service recognizer.\r\n     * The audio source is redundnant here but is required by the implementation.\r\n     * @param authentication\r\n     * @param connectionFactory\r\n     * @param audioConfig\r\n     * @param recognizerConfig\r\n     */\r\n    protected createServiceRecognizer(\r\n        authentication: IAuthentication,\r\n        connectionFactory: IConnectionFactory,\r\n        audioConfig: AudioConfig,\r\n        recognizerConfig: RecognizerConfig): ServiceRecognizerBase {\r\n\r\n        const audioSource: AudioConfigImpl = audioConfig as AudioConfigImpl;\r\n\r\n        return new ConversationServiceAdapter(authentication, connectionFactory, audioSource, recognizerConfig, this);\r\n    }\r\n\r\n    private sendMessage(msg: string, cb?: Callback, err?: Callback): void {\r\n        const withAsync = this.privReco as ConversationServiceAdapter;\r\n        PromiseToEmptyCallback(withAsync.sendMessageAsync(msg), cb, err);\r\n    }\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"script"}