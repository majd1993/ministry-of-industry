"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _textFormatToContentType = _interopRequireDefault(require("./Utils/textFormatToContentType"));

var _useStripMarkdown = _interopRequireDefault(require("./hooks/internal/useStripMarkdown"));

var _useStyleToEmotionObject = _interopRequireDefault(require("./hooks/internal/useStyleToEmotionObject"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useAvatarForBot = _botframeworkWebchatApi.hooks.useAvatarForBot,
    useCreateAttachmentForScreenReaderRenderer = _botframeworkWebchatApi.hooks.useCreateAttachmentForScreenReaderRenderer,
    useDateFormatter = _botframeworkWebchatApi.hooks.useDateFormatter,
    useLocalizer = _botframeworkWebchatApi.hooks.useLocalizer;
var ROOT_STYLE = {
  '&.webchat__screen-reader-activity': {
    color: 'transparent',
    height: 1,
    opacity: 0,
    overflow: 'hidden',
    position: 'absolute',
    top: 0,
    whiteSpace: 'nowrap',
    width: 1
  }
};
var ACTIVITY_NUM_ATTACHMENTS_ALT_IDS = {
  few: 'ACTIVITY_NUM_ATTACHMENTS_FEW_ALT',
  many: 'ACTIVITY_NUM_ATTACHMENTS_MANY_ALT',
  one: 'ACTIVITY_NUM_ATTACHMENTS_ONE_ALT',
  other: 'ACTIVITY_NUM_ATTACHMENTS_OTHER_ALT',
  two: 'ACTIVITY_NUM_ATTACHMENTS_TWO_ALT'
};

var ScreenReaderActivity = function ScreenReaderActivity(_ref) {
  var activity = _ref.activity;

  var _useAvatarForBot = useAvatarForBot(),
      _useAvatarForBot2 = _slicedToArray(_useAvatarForBot, 1),
      botInitials = _useAvatarForBot2[0].initials;

  var createAttachmentForScreenReaderRenderer = useCreateAttachmentForScreenReaderRenderer();
  var formatDate = useDateFormatter();
  var localize = useLocalizer();
  var localizeWithPlural = useLocalizer({
    plural: true
  });
  var rootClassName = (0, _useStyleToEmotionObject.default)()(ROOT_STYLE) + '';
  var _activity$attachments = activity.attachments,
      attachments = _activity$attachments === void 0 ? [] : _activity$attachments,
      _activity$channelData = activity.channelData;
  _activity$channelData = _activity$channelData === void 0 ? {} : _activity$channelData;
  var _activity$channelData2 = _activity$channelData.messageBack;
  _activity$channelData2 = _activity$channelData2 === void 0 ? {} : _activity$channelData2;
  var messageBackDisplayText = _activity$channelData2.displayText,
      _activity$from = activity.from;
  _activity$from = _activity$from === void 0 ? {} : _activity$from;
  var role = _activity$from.role,
      text = activity.text,
      textFormat = activity.textFormat,
      timestamp = activity.timestamp;
  var fromUser = role === 'user';
  var contentTypeMarkdown = (0, _textFormatToContentType.default)(textFormat) === 'text/markdown';
  var displayText = messageBackDisplayText || text;
  var attachmentForScreenReaderRenderers = attachments.map(function (attachment) {
    return createAttachmentForScreenReaderRenderer({
      activity: activity,
      attachment: attachment
    });
  }).filter(function (render) {
    return render;
  });
  var greetingAlt = (fromUser ? localize('ACTIVITY_YOU_SAID_ALT') : localize('ACTIVITY_BOT_SAID_ALT', botInitials || '')).replace(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]{2,}/g, ' ');
  var numGenericAttachments = attachments.length - attachmentForScreenReaderRenderers.length;
  var numAttachmentsAlt = !!numGenericAttachments && localizeWithPlural(ACTIVITY_NUM_ATTACHMENTS_ALT_IDS, numGenericAttachments);
  var textAlt = (0, _useStripMarkdown.default)(contentTypeMarkdown && displayText) || displayText;
  var timestampAlt = localize('ACTIVITY_STATUS_SEND_STATUS_ALT_SENT_AT', formatDate(timestamp));
  return /*#__PURE__*/_react.default.createElement("article", {
    "aria-atomic": true,
    "aria-roledescription": "message",
    className: (0, _classnames.default)('webchat__screen-reader-activity', rootClassName),
    role: "region"
  }, /*#__PURE__*/_react.default.createElement("p", null, /*#__PURE__*/_react.default.createElement("span", null, greetingAlt), /*#__PURE__*/_react.default.createElement("span", null, textAlt)), !!attachmentForScreenReaderRenderers.length && /*#__PURE__*/_react.default.createElement("ul", null, attachmentForScreenReaderRenderers.map(function (render, index) {
    return /*#__PURE__*/_react.default.createElement("li", {
      key: index
    }, render());
  })), numAttachmentsAlt && /*#__PURE__*/_react.default.createElement("p", null, numAttachmentsAlt), /*#__PURE__*/_react.default.createElement("p", {
    className: "webchat__screen-reader-activity__timestamp"
  }, timestampAlt));
};

ScreenReaderActivity.propTypes = {
  activity: _propTypes.default.any.isRequired
};
var _default = ScreenReaderActivity;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TY3JlZW5SZWFkZXJBY3Rpdml0eS5qcyJdLCJuYW1lcyI6WyJ1c2VBdmF0YXJGb3JCb3QiLCJob29rcyIsInVzZUNyZWF0ZUF0dGFjaG1lbnRGb3JTY3JlZW5SZWFkZXJSZW5kZXJlciIsInVzZURhdGVGb3JtYXR0ZXIiLCJ1c2VMb2NhbGl6ZXIiLCJST09UX1NUWUxFIiwiY29sb3IiLCJoZWlnaHQiLCJvcGFjaXR5Iiwib3ZlcmZsb3ciLCJwb3NpdGlvbiIsInRvcCIsIndoaXRlU3BhY2UiLCJ3aWR0aCIsIkFDVElWSVRZX05VTV9BVFRBQ0hNRU5UU19BTFRfSURTIiwiZmV3IiwibWFueSIsIm9uZSIsIm90aGVyIiwidHdvIiwiU2NyZWVuUmVhZGVyQWN0aXZpdHkiLCJhY3Rpdml0eSIsImJvdEluaXRpYWxzIiwiaW5pdGlhbHMiLCJjcmVhdGVBdHRhY2htZW50Rm9yU2NyZWVuUmVhZGVyUmVuZGVyZXIiLCJmb3JtYXREYXRlIiwibG9jYWxpemUiLCJsb2NhbGl6ZVdpdGhQbHVyYWwiLCJwbHVyYWwiLCJyb290Q2xhc3NOYW1lIiwiYXR0YWNobWVudHMiLCJjaGFubmVsRGF0YSIsIm1lc3NhZ2VCYWNrIiwibWVzc2FnZUJhY2tEaXNwbGF5VGV4dCIsImRpc3BsYXlUZXh0IiwiZnJvbSIsInJvbGUiLCJ0ZXh0IiwidGV4dEZvcm1hdCIsInRpbWVzdGFtcCIsImZyb21Vc2VyIiwiY29udGVudFR5cGVNYXJrZG93biIsImF0dGFjaG1lbnRGb3JTY3JlZW5SZWFkZXJSZW5kZXJlcnMiLCJtYXAiLCJhdHRhY2htZW50IiwiZmlsdGVyIiwicmVuZGVyIiwiZ3JlZXRpbmdBbHQiLCJyZXBsYWNlIiwibnVtR2VuZXJpY0F0dGFjaG1lbnRzIiwibGVuZ3RoIiwibnVtQXR0YWNobWVudHNBbHQiLCJ0ZXh0QWx0IiwidGltZXN0YW1wQWx0IiwiaW5kZXgiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJhbnkiLCJpc1JlcXVpcmVkIl0sIm1hcHBpbmdzIjoi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QztBQUMvQmxDLEVBQUFBLFFBQVEsRUFBRW1DLG1CQUFVQyxHQUFWLENBQWNDO0FBRE8sQ0FBakM7ZUFJZXRDLG9CIiwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQgbm8tbWFnaWMtbnVtYmVyczogW1wiZXJyb3JcIiwgeyBcImlnbm9yZVwiOiBbMl0gfV0gKi9cblxuaW1wb3J0IHsgaG9va3MgfSBmcm9tICdib3RmcmFtZXdvcmstd2ViY2hhdC1hcGknO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHRleHRGb3JtYXRUb0NvbnRlbnRUeXBlIGZyb20gJy4vVXRpbHMvdGV4dEZvcm1hdFRvQ29udGVudFR5cGUnO1xuaW1wb3J0IHVzZVN0cmlwTWFya2Rvd24gZnJvbSAnLi9ob29rcy9pbnRlcm5hbC91c2VTdHJpcE1hcmtkb3duJztcbmltcG9ydCB1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCBmcm9tICcuL2hvb2tzL2ludGVybmFsL3VzZVN0eWxlVG9FbW90aW9uT2JqZWN0JztcblxuY29uc3QgeyB1c2VBdmF0YXJGb3JCb3QsIHVzZUNyZWF0ZUF0dGFjaG1lbnRGb3JTY3JlZW5SZWFkZXJSZW5kZXJlciwgdXNlRGF0ZUZvcm1hdHRlciwgdXNlTG9jYWxpemVyIH0gPSBob29rcztcblxuY29uc3QgUk9PVF9TVFlMRSA9IHtcbiAgJyYud2ViY2hhdF9fc2NyZWVuLXJlYWRlci1hY3Rpdml0eSc6IHtcbiAgICBjb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICBoZWlnaHQ6IDEsXG4gICAgb3BhY2l0eTogMCxcbiAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgdG9wOiAwLFxuICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnLFxuICAgIHdpZHRoOiAxXG4gIH1cbn07XG5cbmNvbnN0IEFDVElWSVRZX05VTV9BVFRBQ0hNRU5UU19BTFRfSURTID0ge1xuICBmZXc6ICdBQ1RJVklUWV9OVU1fQVRUQUNITUVOVFNfRkVXX0FMVCcsXG4gIG1hbnk6ICdBQ1RJVklUWV9OVU1fQVRUQUNITUVOVFNfTUFOWV9BTFQnLFxuICBvbmU6ICdBQ1RJVklUWV9OVU1fQVRUQUNITUVOVFNfT05FX0FMVCcsXG4gIG90aGVyOiAnQUNUSVZJVFlfTlVNX0FUVEFDSE1FTlRTX09USEVSX0FMVCcsXG4gIHR3bzogJ0FDVElWSVRZX05VTV9BVFRBQ0hNRU5UU19UV09fQUxUJ1xufTtcblxuY29uc3QgU2NyZWVuUmVhZGVyQWN0aXZpdHkgPSAoeyBhY3Rpdml0eSB9KSA9PiB7XG4gIGNvbnN0IFt7IGluaXRpYWxzOiBib3RJbml0aWFscyB9XSA9IHVzZUF2YXRhckZvckJvdCgpO1xuICBjb25zdCBjcmVhdGVBdHRhY2htZW50Rm9yU2NyZWVuUmVhZGVyUmVuZGVyZXIgPSB1c2VDcmVhdGVBdHRhY2htZW50Rm9yU2NyZWVuUmVhZGVyUmVuZGVyZXIoKTtcbiAgY29uc3QgZm9ybWF0RGF0ZSA9IHVzZURhdGVGb3JtYXR0ZXIoKTtcbiAgY29uc3QgbG9jYWxpemUgPSB1c2VMb2NhbGl6ZXIoKTtcbiAgY29uc3QgbG9jYWxpemVXaXRoUGx1cmFsID0gdXNlTG9jYWxpemVyKHsgcGx1cmFsOiB0cnVlIH0pO1xuICBjb25zdCByb290Q2xhc3NOYW1lID0gdXNlU3R5bGVUb0Vtb3Rpb25PYmplY3QoKShST09UX1NUWUxFKSArICcnO1xuXG4gIGNvbnN0IHtcbiAgICBhdHRhY2htZW50cyA9IFtdLFxuICAgIGNoYW5uZWxEYXRhOiB7IG1lc3NhZ2VCYWNrOiB7IGRpc3BsYXlUZXh0OiBtZXNzYWdlQmFja0Rpc3BsYXlUZXh0IH0gPSB7fSB9ID0ge30sXG4gICAgZnJvbTogeyByb2xlIH0gPSB7fSxcbiAgICB0ZXh0LFxuICAgIHRleHRGb3JtYXQsXG4gICAgdGltZXN0YW1wXG4gIH0gPSBhY3Rpdml0eTtcblxuICBjb25zdCBmcm9tVXNlciA9IHJvbGUgPT09ICd1c2VyJztcbiAgY29uc3QgY29udGVudFR5cGVNYXJrZG93biA9IHRleHRGb3JtYXRUb0NvbnRlbnRUeXBlKHRleHRGb3JtYXQpID09PSAndGV4dC9tYXJrZG93bic7XG4gIGNvbnN0IGRpc3BsYXlUZXh0ID0gbWVzc2FnZUJhY2tEaXNwbGF5VGV4dCB8fCB0ZXh0O1xuXG4gIGNvbnN0IGF0dGFjaG1lbnRGb3JTY3JlZW5SZWFkZXJSZW5kZXJlcnMgPSBhdHRhY2htZW50c1xuICAgIC5tYXAoYXR0YWNobWVudCA9PiBjcmVhdGVBdHRhY2htZW50Rm9yU2NyZWVuUmVhZGVyUmVuZGVyZXIoeyBhY3Rpdml0eSwgYXR0YWNobWVudCB9KSlcbiAgICAuZmlsdGVyKHJlbmRlciA9PiByZW5kZXIpO1xuXG4gIGNvbnN0IGdyZWV0aW5nQWx0ID0gKGZyb21Vc2VyXG4gICAgPyBsb2NhbGl6ZSgnQUNUSVZJVFlfWU9VX1NBSURfQUxUJylcbiAgICA6IGxvY2FsaXplKCdBQ1RJVklUWV9CT1RfU0FJRF9BTFQnLCBib3RJbml0aWFscyB8fCAnJylcbiAgKS5yZXBsYWNlKC9cXHN7Mix9L2d1LCAnICcpO1xuICBjb25zdCBudW1HZW5lcmljQXR0YWNobWVudHMgPSBhdHRhY2htZW50cy5sZW5ndGggLSBhdHRhY2htZW50Rm9yU2NyZWVuUmVhZGVyUmVuZGVyZXJzLmxlbmd0aDtcblxuICBjb25zdCBudW1BdHRhY2htZW50c0FsdCA9XG4gICAgISFudW1HZW5lcmljQXR0YWNobWVudHMgJiYgbG9jYWxpemVXaXRoUGx1cmFsKEFDVElWSVRZX05VTV9BVFRBQ0hNRU5UU19BTFRfSURTLCBudW1HZW5lcmljQXR0YWNobWVudHMpO1xuICBjb25zdCB0ZXh0QWx0ID0gdXNlU3RyaXBNYXJrZG93bihjb250ZW50VHlwZU1hcmtkb3duICYmIGRpc3BsYXlUZXh0KSB8fCBkaXNwbGF5VGV4dDtcbiAgY29uc3QgdGltZXN0YW1wQWx0ID0gbG9jYWxpemUoJ0FDVElWSVRZX1NUQVRVU19TRU5EX1NUQVRVU19BTFRfU0VOVF9BVCcsIGZvcm1hdERhdGUodGltZXN0YW1wKSk7XG5cbiAgcmV0dXJuIChcbiAgICA8YXJ0aWNsZVxuICAgICAgYXJpYS1hdG9taWM9e3RydWV9XG4gICAgICBhcmlhLXJvbGVkZXNjcmlwdGlvbj1cIm1lc3NhZ2VcIlxuICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKCd3ZWJjaGF0X19zY3JlZW4tcmVhZGVyLWFjdGl2aXR5Jywgcm9vdENsYXNzTmFtZSl9XG4gICAgICByb2xlPVwicmVnaW9uXCJcbiAgICA+XG4gICAgICA8cD5cbiAgICAgICAgPHNwYW4+e2dyZWV0aW5nQWx0fTwvc3Bhbj5cbiAgICAgICAgPHNwYW4+e3RleHRBbHR9PC9zcGFuPlxuICAgICAgPC9wPlxuICAgICAgeyEhYXR0YWNobWVudEZvclNjcmVlblJlYWRlclJlbmRlcmVycy5sZW5ndGggJiYgKFxuICAgICAgICA8dWw+XG4gICAgICAgICAge2F0dGFjaG1lbnRGb3JTY3JlZW5SZWFkZXJSZW5kZXJlcnMubWFwKChyZW5kZXIsIGluZGV4KSA9PiAoXG4gICAgICAgICAgICA8bGkga2V5PXtpbmRleH0+e3JlbmRlcigpfTwvbGk+XG4gICAgICAgICAgKSl9XG4gICAgICAgIDwvdWw+XG4gICAgICApfVxuICAgICAge251bUF0dGFjaG1lbnRzQWx0ICYmIDxwPntudW1BdHRhY2htZW50c0FsdH08L3A+fVxuICAgICAgPHAgY2xhc3NOYW1lPVwid2ViY2hhdF9fc2NyZWVuLXJlYWRlci1hY3Rpdml0eV9fdGltZXN0YW1wXCI+e3RpbWVzdGFtcEFsdH08L3A+XG4gICAgPC9hcnRpY2xlPlxuICApO1xufTtcblxuU2NyZWVuUmVhZGVyQWN0aXZpdHkucHJvcFR5cGVzID0ge1xuICBhY3Rpdml0eTogUHJvcFR5cGVzLmFueS5pc1JlcXVpcmVkXG59O1xuXG5leHBvcnQgZGVmYXVsdCBTY3JlZW5SZWFkZXJBY3Rpdml0eTtcbiJdfQ==