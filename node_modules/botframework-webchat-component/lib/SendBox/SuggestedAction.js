"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.connectSuggestedAction = exports.default = void 0;

var _botframeworkWebchatApi = require("botframework-webchat-api");

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _AccessibleButton = _interopRequireDefault(require("../Utils/AccessibleButton"));

var _connectToWebChat = _interopRequireDefault(require("../connectToWebChat"));

var _useFocus = _interopRequireDefault(require("../hooks/useFocus"));

var _useFocusAccessKeyEffect = _interopRequireDefault(require("../Utils/AccessKeySink/useFocusAccessKeyEffect"));

var _useLocalizeAccessKey = _interopRequireDefault(require("../hooks/internal/useLocalizeAccessKey"));

var _useScrollToEnd = _interopRequireDefault(require("../hooks/useScrollToEnd"));

var _useSuggestedActionsAccessKey = _interopRequireDefault(require("../hooks/internal/useSuggestedActionsAccessKey"));

var _useStyleSet3 = _interopRequireDefault(require("../hooks/useStyleSet"));

var _useStyleToEmotionObject = _interopRequireDefault(require("../hooks/internal/useStyleToEmotionObject"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

var useDirection = _botframeworkWebchatApi.hooks.useDirection,
    useDisabled = _botframeworkWebchatApi.hooks.useDisabled,
    usePerformCardAction = _botframeworkWebchatApi.hooks.usePerformCardAction,
    useSuggestedActions = _botframeworkWebchatApi.hooks.useSuggestedActions;
var ROOT_STYLE = {
  '&.webchat__suggested-action': {
    display: 'flex',
    flexDirection: 'column',
    whiteSpace: 'initial',
    '& .webchat__suggested-action__button': {
      display: 'flex',
      overflow: 'hidden'
    }
  }
};

var connectSuggestedAction = function connectSuggestedAction() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return _connectToWebChat.default.apply(void 0, [function (_ref, _ref2) {
    var clearSuggestedActions = _ref.clearSuggestedActions,
        disabled = _ref.disabled,
        language = _ref.language,
        onCardAction = _ref.onCardAction;
    var displayText = _ref2.displayText,
        text = _ref2.text,
        type = _ref2.type,
        value = _ref2.value;
    return {
      click: function click() {
        onCardAction({
          displayText: displayText,
          text: text,
          type: type,
          value: value
        });
        type === 'openUrl' && clearSuggestedActions();
      },
      disabled: disabled,
      language: language
    };
  }].concat(selectors));
};

exports.connectSuggestedAction = connectSuggestedAction;

var SuggestedAction = function SuggestedAction(_ref3) {
  var ariaHidden = _ref3['aria-hidden'],
      buttonText = _ref3.buttonText,
      displayText = _ref3.displayText,
      image = _ref3.image,
      imageAlt = _ref3.imageAlt,
      text = _ref3.text,
      type = _ref3.type,
      value = _ref3.value;

  var _useSuggestedActions = useSuggestedActions(),
      _useSuggestedActions2 = _slicedToArray(_useSuggestedActions, 2),
      _ = _useSuggestedActions2[0],
      setSuggestedActions = _useSuggestedActions2[1];

  var _useStyleSet = (0, _useStyleSet3.default)(),
      _useStyleSet2 = _slicedToArray(_useStyleSet, 1),
      suggestedActionStyleSet = _useStyleSet2[0].suggestedAction;

  var _useSuggestedActionsA = (0, _useSuggestedActionsAccessKey.default)(),
      _useSuggestedActionsA2 = _slicedToArray(_useSuggestedActionsA, 1),
      accessKey = _useSuggestedActionsA2[0];

  var _useDirection = useDirection(),
      _useDirection2 = _slicedToArray(_useDirection, 1),
      direction = _useDirection2[0];

  var _useDisabled = useDisabled(),
      _useDisabled2 = _slicedToArray(_useDisabled, 1),
      disabled = _useDisabled2[0];

  var focus = (0, _useFocus.default)();
  var focusRef = (0, _react.useRef)();
  var localizeAccessKey = (0, _useLocalizeAccessKey.default)();
  var performCardAction = usePerformCardAction();
  var scrollToEnd = (0, _useScrollToEnd.default)();
  var rootClassName = (0, _useStyleToEmotionObject.default)()(ROOT_STYLE) + '';
  var handleClick = (0, _react.useCallback)(function (_ref4) {
    var target = _ref4.target;
    performCardAction({
      displayText: displayText,
      text: text,
      type: type,
      value: value
    }, {
      target: target
    }); // Since "openUrl" action do not submit, the suggested action buttons do not hide after click.

    type === 'openUrl' && setSuggestedActions([]);
    focus('sendBoxWithoutKeyboard');
    scrollToEnd();
  }, [displayText, focus, performCardAction, scrollToEnd, setSuggestedActions, text, type, value]);
  (0, _useFocusAccessKeyEffect.default)(accessKey, focusRef);
  return /*#__PURE__*/_react.default.createElement("div", {
    "aria-hidden": ariaHidden,
    className: (0, _classnames.default)('webchat__suggested-action', rootClassName, suggestedActionStyleSet + '')
  }, /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, _extends({}, accessKey ? {
    'aria-keyshortcuts': localizeAccessKey(accessKey)
  } : {}, {
    className: "webchat__suggested-action__button",
    disabled: disabled,
    onClick: handleClick,
    ref: focusRef,
    type: "button"
  }), image && /*#__PURE__*/_react.default.createElement("img", {
    alt: imageAlt,
    className: (0, _classnames.default)('webchat__suggested-action__image', direction === 'rtl' && 'webchat__suggested-action__image--rtl'),
    src: image
  }), /*#__PURE__*/_react.default.createElement("nobr", {
    className: "webchat__suggested-action__button-text"
  }, buttonText)));
};

SuggestedAction.defaultProps = {
  'aria-hidden': false,
  displayText: '',
  image: '',
  imageAlt: undefined,
  text: '',
  type: '',
  value: undefined
};
SuggestedAction.propTypes = {
  'aria-hidden': _propTypes.default.bool,
  buttonText: _propTypes.default.string.isRequired,
  displayText: _propTypes.default.string,
  image: _propTypes.default.string,
  imageAlt: _propTypes.default.string,
  text: _propTypes.default.string,
  type: _propTypes.default.string,
  value: _propTypes.default.any
};
var _default = SuggestedAction;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TZW5kQm94L1N1Z2dlc3RlZEFjdGlvbi5qcyJdLCJuYW1lcyI6WyJ1c2VEaXJlY3Rpb24iLCJob29rcyIsInVzZURpc2FibGVkIiwidXNlUGVyZm9ybUNhcmRBY3Rpb24iLCJ1c2VTdWdnZXN0ZWRBY3Rpb25zIiwiUk9PVF9TVFlMRSIsImRpc3BsYXkiLCJmbGV4RGlyZWN0aW9uIiwid2hpdGVTcGFjZSIsIm92ZXJmbG93IiwiY29ubmVjdFN1Z2dlc3RlZEFjdGlvbiIsInNlbGVjdG9ycyIsImNvbm5lY3RUb1dlYkNoYXQiLCJjbGVhclN1Z2dlc3RlZEFjdGlvbnMiLCJkaXNhYmxlZCIsImxhbmd1YWdlIiwib25DYXJkQWN0aW9uIiwiZGlzcGxheVRleHQiLCJ0ZXh0IiwidHlwZSIsInZhbHVlIiwiY2xpY2siLCJTdWdnZXN0ZWRBY3Rpb24iLCJhcmlhSGlkZGVuIiwiYnV0dG9uVGV4dCIsImltYWdlIiwiaW1hZ2VBbHQiLCJfIiwic2V0U3VnZ2VzdGVkQWN0aW9ucyIsInN1Z2dlc3RlZEFjdGlvblN0eWxlU2V0Iiwic3VnZ2VzdGVkQWN0aW9uIiwiYWNjZXNzS2V5IiwiZGlyZWN0aW9uIiwiZm9jdXMiLCJmb2N1c1JlZiIsImxvY2FsaXplQWNjZXNzS2V5IiwicGVyZm9ybUNhcmRBY3Rpb24iLCJzY3JvbGxUb0VuZCIsInJvb3RDbGFzc05hbWUiLCJoYW5kbGVDbGljayIsInRhcmdldCIsImRlZmF1bHRQcm9wcyIsInVuZGVmaW5lZCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsImJvb2wiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwiYW55Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUVRQSxZLEdBQXlFQyw2QixDQUF6RUQsWTtJQUFjRSxXLEdBQTJERCw2QixD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TSxJQUFBLFNBQVMsRUFBQztBQUFoQixLQUEwREQsVUFBMUQsQ0FsQkYsQ0FKRixDQURGO0FBMkJELENBaEVEOztBQWtFQUYsZUFBZSxDQUFDbUIsWUFBaEIsR0FBK0I7QUFDN0IsaUJBQWUsS0FEYztBQUU3QnhCLEVBQUFBLFdBQVcsRUFBRSxFQUZnQjtBQUc3QlEsRUFBQUEsS0FBSyxFQUFFLEVBSHNCO0FBSTdCQyxFQUFBQSxRQUFRLEVBQUVnQixTQUptQjtBQUs3QnhCLEVBQUFBLElBQUksRUFBRSxFQUx1QjtBQU03QkMsRUFBQUEsSUFBSSxFQUFFLEVBTnVCO0FBTzdCQyxFQUFBQSxLQUFLLEVBQUVzQjtBQVBzQixDQUEvQjtBQVVBcEIsZUFBZSxDQUFDcUIsU0FBaEIsR0FBNEI7QUFDMUIsaUJBQWVDLG1CQUFVQyxJQURDO0FBRTFCckIsRUFBQUEsVUFBVSxFQUFFb0IsbUJBQVVFLE1BQVYsQ0FBaUJDLFVBRkg7QUFHMUI5QixFQUFBQSxXQUFXLEVBQUUyQixtQkFBVUUsTUFIRztBQUkxQnJCLEVBQUFBLEtBQUssRUFBRW1CLG1CQUFVRSxNQUpTO0FBSzFCcEIsRUFBQUEsUUFBUSxFQUFFa0IsbUJBQVVFLE1BTE07QUFNMUI1QixFQUFBQSxJQUFJLEVBQUUwQixtQkFBVUUsTUFOVTtBQU8xQjNCLEVBQUFBLElBQUksRUFBRXlCLG1CQUFVRSxNQVBVO0FBUTFCMUIsRUFBQUEsS0FBSyxFQUFFd0IsbUJBQVVJO0FBUlMsQ0FBNUI7ZUFXZTFCLGUiLCJzb3VyY2VSb290IjoiY29tcG9uZW50Oi8vLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGhvb2tzIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtYXBpJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlUmVmIH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tICcuLi9VdGlscy9BY2Nlc3NpYmxlQnV0dG9uJztcbmltcG9ydCBjb25uZWN0VG9XZWJDaGF0IGZyb20gJy4uL2Nvbm5lY3RUb1dlYkNoYXQnO1xuaW1wb3J0IHVzZUZvY3VzIGZyb20gJy4uL2hvb2tzL3VzZUZvY3VzJztcbmltcG9ydCB1c2VGb2N1c0FjY2Vzc0tleUVmZmVjdCBmcm9tICcuLi9VdGlscy9BY2Nlc3NLZXlTaW5rL3VzZUZvY3VzQWNjZXNzS2V5RWZmZWN0JztcbmltcG9ydCB1c2VMb2NhbGl6ZUFjY2Vzc0tleSBmcm9tICcuLi9ob29rcy9pbnRlcm5hbC91c2VMb2NhbGl6ZUFjY2Vzc0tleSc7XG5pbXBvcnQgdXNlU2Nyb2xsVG9FbmQgZnJvbSAnLi4vaG9va3MvdXNlU2Nyb2xsVG9FbmQnO1xuaW1wb3J0IHVzZVN1Z2dlc3RlZEFjdGlvbnNBY2Nlc3NLZXkgZnJvbSAnLi4vaG9va3MvaW50ZXJuYWwvdXNlU3VnZ2VzdGVkQWN0aW9uc0FjY2Vzc0tleSc7XG5pbXBvcnQgdXNlU3R5bGVTZXQgZnJvbSAnLi4vaG9va3MvdXNlU3R5bGVTZXQnO1xuaW1wb3J0IHVzZVN0eWxlVG9FbW90aW9uT2JqZWN0IGZyb20gJy4uL2hvb2tzL2ludGVybmFsL3VzZVN0eWxlVG9FbW90aW9uT2JqZWN0JztcblxuY29uc3QgeyB1c2VEaXJlY3Rpb24sIHVzZURpc2FibGVkLCB1c2VQZXJmb3JtQ2FyZEFjdGlvbiwgdXNlU3VnZ2VzdGVkQWN0aW9ucyB9ID0gaG9va3M7XG5cbmNvbnN0IFJPT1RfU1RZTEUgPSB7XG4gICcmLndlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb24nOiB7XG4gICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgIHdoaXRlU3BhY2U6ICdpbml0aWFsJyxcblxuICAgICcmIC53ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uX19idXR0b24nOiB7XG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBvdmVyZmxvdzogJ2hpZGRlbidcbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IGNvbm5lY3RTdWdnZXN0ZWRBY3Rpb24gPSAoLi4uc2VsZWN0b3JzKSA9PlxuICBjb25uZWN0VG9XZWJDaGF0KFxuICAgICh7IGNsZWFyU3VnZ2VzdGVkQWN0aW9ucywgZGlzYWJsZWQsIGxhbmd1YWdlLCBvbkNhcmRBY3Rpb24gfSwgeyBkaXNwbGF5VGV4dCwgdGV4dCwgdHlwZSwgdmFsdWUgfSkgPT4gKHtcbiAgICAgIGNsaWNrOiAoKSA9PiB7XG4gICAgICAgIG9uQ2FyZEFjdGlvbih7IGRpc3BsYXlUZXh0LCB0ZXh0LCB0eXBlLCB2YWx1ZSB9KTtcbiAgICAgICAgdHlwZSA9PT0gJ29wZW5VcmwnICYmIGNsZWFyU3VnZ2VzdGVkQWN0aW9ucygpO1xuICAgICAgfSxcbiAgICAgIGRpc2FibGVkLFxuICAgICAgbGFuZ3VhZ2VcbiAgICB9KSxcbiAgICAuLi5zZWxlY3RvcnNcbiAgKTtcblxuY29uc3QgU3VnZ2VzdGVkQWN0aW9uID0gKHtcbiAgJ2FyaWEtaGlkZGVuJzogYXJpYUhpZGRlbixcbiAgYnV0dG9uVGV4dCxcbiAgZGlzcGxheVRleHQsXG4gIGltYWdlLFxuICBpbWFnZUFsdCxcbiAgdGV4dCxcbiAgdHlwZSxcbiAgdmFsdWVcbn0pID0+IHtcbiAgY29uc3QgW18sIHNldFN1Z2dlc3RlZEFjdGlvbnNdID0gdXNlU3VnZ2VzdGVkQWN0aW9ucygpO1xuICBjb25zdCBbeyBzdWdnZXN0ZWRBY3Rpb246IHN1Z2dlc3RlZEFjdGlvblN0eWxlU2V0IH1dID0gdXNlU3R5bGVTZXQoKTtcbiAgY29uc3QgW2FjY2Vzc0tleV0gPSB1c2VTdWdnZXN0ZWRBY3Rpb25zQWNjZXNzS2V5KCk7XG4gIGNvbnN0IFtkaXJlY3Rpb25dID0gdXNlRGlyZWN0aW9uKCk7XG4gIGNvbnN0IFtkaXNhYmxlZF0gPSB1c2VEaXNhYmxlZCgpO1xuICBjb25zdCBmb2N1cyA9IHVzZUZvY3VzKCk7XG4gIGNvbnN0IGZvY3VzUmVmID0gdXNlUmVmKCk7XG4gIGNvbnN0IGxvY2FsaXplQWNjZXNzS2V5ID0gdXNlTG9jYWxpemVBY2Nlc3NLZXkoKTtcbiAgY29uc3QgcGVyZm9ybUNhcmRBY3Rpb24gPSB1c2VQZXJmb3JtQ2FyZEFjdGlvbigpO1xuICBjb25zdCBzY3JvbGxUb0VuZCA9IHVzZVNjcm9sbFRvRW5kKCk7XG4gIGNvbnN0IHJvb3RDbGFzc05hbWUgPSB1c2VTdHlsZVRvRW1vdGlvbk9iamVjdCgpKFJPT1RfU1RZTEUpICsgJyc7XG5cbiAgY29uc3QgaGFuZGxlQ2xpY2sgPSB1c2VDYWxsYmFjayhcbiAgICAoeyB0YXJnZXQgfSkgPT4ge1xuICAgICAgcGVyZm9ybUNhcmRBY3Rpb24oeyBkaXNwbGF5VGV4dCwgdGV4dCwgdHlwZSwgdmFsdWUgfSwgeyB0YXJnZXQgfSk7XG5cbiAgICAgIC8vIFNpbmNlIFwib3BlblVybFwiIGFjdGlvbiBkbyBub3Qgc3VibWl0LCB0aGUgc3VnZ2VzdGVkIGFjdGlvbiBidXR0b25zIGRvIG5vdCBoaWRlIGFmdGVyIGNsaWNrLlxuICAgICAgdHlwZSA9PT0gJ29wZW5VcmwnICYmIHNldFN1Z2dlc3RlZEFjdGlvbnMoW10pO1xuXG4gICAgICBmb2N1cygnc2VuZEJveFdpdGhvdXRLZXlib2FyZCcpO1xuICAgICAgc2Nyb2xsVG9FbmQoKTtcbiAgICB9LFxuICAgIFtkaXNwbGF5VGV4dCwgZm9jdXMsIHBlcmZvcm1DYXJkQWN0aW9uLCBzY3JvbGxUb0VuZCwgc2V0U3VnZ2VzdGVkQWN0aW9ucywgdGV4dCwgdHlwZSwgdmFsdWVdXG4gICk7XG5cbiAgdXNlRm9jdXNBY2Nlc3NLZXlFZmZlY3QoYWNjZXNzS2V5LCBmb2N1c1JlZik7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBhcmlhLWhpZGRlbj17YXJpYUhpZGRlbn1cbiAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcygnd2ViY2hhdF9fc3VnZ2VzdGVkLWFjdGlvbicsIHJvb3RDbGFzc05hbWUsIHN1Z2dlc3RlZEFjdGlvblN0eWxlU2V0ICsgJycpfVxuICAgID5cbiAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uXG4gICAgICAgIHsuLi4oYWNjZXNzS2V5ID8geyAnYXJpYS1rZXlzaG9ydGN1dHMnOiBsb2NhbGl6ZUFjY2Vzc0tleShhY2Nlc3NLZXkpIH0gOiB7fSl9XG4gICAgICAgIGNsYXNzTmFtZT1cIndlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb25fX2J1dHRvblwiXG4gICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgICAgb25DbGljaz17aGFuZGxlQ2xpY2t9XG4gICAgICAgIHJlZj17Zm9jdXNSZWZ9XG4gICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgPlxuICAgICAgICB7aW1hZ2UgJiYgKFxuICAgICAgICAgIDxpbWdcbiAgICAgICAgICAgIGFsdD17aW1hZ2VBbHR9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXG4gICAgICAgICAgICAgICd3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uX19pbWFnZScsXG4gICAgICAgICAgICAgIGRpcmVjdGlvbiA9PT0gJ3J0bCcgJiYgJ3dlYmNoYXRfX3N1Z2dlc3RlZC1hY3Rpb25fX2ltYWdlLS1ydGwnXG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgc3JjPXtpbWFnZX1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgICA8bm9iciBjbGFzc05hbWU9XCJ3ZWJjaGF0X19zdWdnZXN0ZWQtYWN0aW9uX19idXR0b24tdGV4dFwiPntidXR0b25UZXh0fTwvbm9icj5cbiAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cblN1Z2dlc3RlZEFjdGlvbi5kZWZhdWx0UHJvcHMgPSB7XG4gICdhcmlhLWhpZGRlbic6IGZhbHNlLFxuICBkaXNwbGF5VGV4dDogJycsXG4gIGltYWdlOiAnJyxcbiAgaW1hZ2VBbHQ6IHVuZGVmaW5lZCxcbiAgdGV4dDogJycsXG4gIHR5cGU6ICcnLFxuICB2YWx1ZTogdW5kZWZpbmVkXG59O1xuXG5TdWdnZXN0ZWRBY3Rpb24ucHJvcFR5cGVzID0ge1xuICAnYXJpYS1oaWRkZW4nOiBQcm9wVHlwZXMuYm9vbCxcbiAgYnV0dG9uVGV4dDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICBkaXNwbGF5VGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgaW1hZ2U6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGltYWdlQWx0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICB0ZXh0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICB0eXBlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB2YWx1ZTogUHJvcFR5cGVzLmFueVxufTtcblxuZXhwb3J0IGRlZmF1bHQgU3VnZ2VzdGVkQWN0aW9uO1xuXG5leHBvcnQgeyBjb25uZWN0U3VnZ2VzdGVkQWN0aW9uIH07XG4iXX0=