"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _SpeechToText = require("web-speech-cognitive-services/lib/SpeechServices/SpeechToText");

var _abortControllerEs = _interopRequireDefault(require("abort-controller-es5"));

var _createCustomEvent = _interopRequireDefault(require("./createCustomEvent"));

var _createErrorEvent = _interopRequireDefault(require("./createErrorEvent"));

var _createTaskQueue2 = _interopRequireDefault(require("./createTaskQueue"));

var _eventTargetShimEs = _interopRequireWildcard(require("event-target-shim-es5"));

var _playCognitiveServicesStream = _interopRequireDefault(require("./playCognitiveServicesStream"));

var _playWhiteNoise = _interopRequireDefault(require("./playWhiteNoise"));

var _SpeechSynthesisAudioStreamUtterance = _interopRequireDefault(require("./SpeechSynthesisAudioStreamUtterance"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _default(_ref) {
  var audioContext = _ref.audioContext,
      enableTelemetry = _ref.enableTelemetry,
      _ref$ponyfill = _ref.ponyfill,
      ponyfill = _ref$ponyfill === void 0 ? {
    AudioContext: window.AudioContext || window.webkitAudioContext
  } : _ref$ponyfill,
      recognizer = _ref.recognizer,
      textNormalization = _ref.textNormalization;

  if (!ponyfill.AudioContext) {
    console.warn('botframework-directlinespeech-sdk: This browser does not support Web Audio API. Speech support is disabled.');
    return function () {
      return {};
    };
  }

  return function () {
    var _createSpeechRecognit = (0, _SpeechToText.createSpeechRecognitionPonyfillFromRecognizer)({
      createRecognizer: function createRecognizer() {
        return recognizer;
      },
      enableTelemetry: enableTelemetry,
      looseEvents: true,
      textNormalization: textNormalization
    }),
        SpeechGrammarList = _createSpeechRecognit.SpeechGrammarList,
        SpeechRecognition = _createSpeechRecognit.SpeechRecognition;

    if (!audioContext) {
      audioContext = new ponyfill.AudioContext();
    }

    var _createTaskQueue = (0, _createTaskQueue2.default)(),
        cancelAll = _createTaskQueue.cancelAll,
        push = _createTaskQueue.push;

    var SpeechSynthesis = /*#__PURE__*/function (_EventTargetShim) {
      (0, _inherits2.default)(SpeechSynthesis, _EventTargetShim);

      var _super = _createSuper(SpeechSynthesis);

      function SpeechSynthesis() {
        (0, _classCallCheck2.default)(this, SpeechSynthesis);
        return _super.apply(this, arguments);
      }

      (0, _createClass2.default)(SpeechSynthesis, [{
        key: "cancel",
        value: function cancel() {
          cancelAll();
        } // Returns an empty array.
        // Synthesis is done on the bot side, the content of the voice list is not meaningful on the client side.

      }, {
        key: "getVoices",
        value: function getVoices() {
          return [];
        }
      }, {
        key: "speak",
        value: function speak(utterance) {
          var _push = push(function () {
            var controller = new _abortControllerEs.default();
            var signal = controller.signal;
            return {
              abort: controller.abort.bind(controller),
              result: (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {
                return _regenerator.default.wrap(function _callee$(_context) {
                  while (1) {
                    switch (_context.prev = _context.next) {
                      case 0:
                        utterance.dispatchEvent((0, _createCustomEvent.default)('start'));
                        _context.prev = 1;

                        if (!utterance.audioStream) {
                          _context.next = 7;
                          break;
                        }

                        _context.next = 5;
                        return (0, _playCognitiveServicesStream.default)(audioContext, utterance.audioStream, {
                          signal: signal
                        });

                      case 5:
                        _context.next = 9;
                        break;

                      case 7:
                        _context.next = 9;
                        return (0, _playWhiteNoise.default)(audioContext);

                      case 9:
                        _context.next = 15;
                        break;

                      case 11:
                        _context.prev = 11;
                        _context.t0 = _context["catch"](1);

                        if (!(_context.t0.message !== 'aborted')) {
                          _context.next = 15;
                          break;
                        }

                        return _context.abrupt("return", utterance.dispatchEvent((0, _createErrorEvent.default)(_context.t0)));

                      case 15:
                        utterance.dispatchEvent((0, _createCustomEvent.default)('end'));

                      case 16:
                      case "end":
                        return _context.stop();
                    }
                  }
                }, _callee, null, [[1, 11]]);
              }))()
            };
          }),
              result = _push.result; // Catching the error to prevent uncaught promise error due to cancellation.


          result.catch(function (error) {
            if (!/^cancelled/i.test(error.message)) {
              throw error;
            }
          });
        }
      }]);
      return SpeechSynthesis;
    }(_eventTargetShimEs.default);

    (0, _eventTargetShimEs.defineEventAttribute)(SpeechSynthesis, 'voiceschanged');
    return {
      SpeechGrammarList: SpeechGrammarList,
      SpeechRecognition: SpeechRecognition,
      speechSynthesis: new SpeechSynthesis(),
      SpeechSynthesisUtterance: _SpeechSynthesisAudioStreamUtterance.default
    };
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jcmVhdGVXZWJTcGVlY2hQb255ZmlsbEZhY3RvcnkuanMiXSwibmFtZXMiOlsiYXVkaW9Db250ZXh0IiwiZW5hYmxlVGVsZW1ldHJ5IiwicG9ueWZpbGwiLCJBdWRpb0NvbnRleHQiLCJ3aW5kb3ciLCJ3ZWJraXRBdWRpb0NvbnRleHQiLCJyZWNvZ25pemVyIiwidGV4dE5vcm1hbGl6YXRpb24iLCJjb25zb2xlIiwid2FybiIsImNyZWF0ZVJlY29nbml6ZXIiLCJsb29zZUV2ZW50cyIsIlNwZWVjaEdyYW1tYXJMaXN0IiwiU3BlZWNoUmVjb2duaXRpb24iLCJjYW5jZWxBbGwiLCJwdXNoIiwiU3BlZWNoU3ludGhlc2lzIiwidXR0ZXJhbmNlIiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsInNpZ25hbCIsImFib3J0IiwiYmluZCIsInJlc3VsdCIsImRpc3BhdGNoRXZlbnQiLCJhdWRpb1N0cmVhbSIsIm1lc3NhZ2UiLCJjYXRjaCIsImVycm9yIiwidGVzdCIsIkV2ZW50VGFyZ2V0U2hpbSIsInNwZWVjaFN5bnRoZXNpcyIsIlNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZSIsIlNwZWVjaFN5bnRoZXNpc0F1ZGlvU3RyZWFtVXR0ZXJhbmNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVlLHdCQVFaO0FBQUEsTUFQREEsWUFPQyxRQVBEQSxZQU9DO0FBQUEsTUFOREMsZUFNQyxRQU5EQSxlQU1DO0FBQUEsMkJBTERDLFFBS0M7QUFBQSxNQUxEQSxRQUtDLDhCQUxVO0FBQ1RDLElBQUFBLFlBQVksRUFBRUMsTUFBTSxDQUFDRCxZQUFQLElBQXVCQyxNQUFNLENBQUNDO0FBRG5DLEdBS1Y7QUFBQSxNQUZEQyxVQUVDLFFBRkRBLFVBRUM7QUFBQSxNQUREQyxpQkFDQyxRQUREQSxpQkFDQzs7QUFDRCxNQUFJ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SztBQUdMa0IsTUFBQUEsZUFBZSxFQUFFLElBQUlmLGVBQUosRUFIWjtBQUlMZ0IsTUFBQUEsd0JBQXdCLEVBQUVDO0FBSnJCLEtBQVA7QUFNRCxHQXRFRDtBQXVFRCIsInNvdXJjZVJvb3QiOiJkaXJlY3RsaW5lc3BlZWNoOi8vLyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCBjbGFzcy1tZXRob2RzLXVzZS10aGlzOiBbXCJlcnJvclwiLCB7IFwiZXhjZXB0TWV0aG9kc1wiOiBbXCJjYW5jZWxcIiwgXCJnZXRWb2ljZXNcIiwgXCJzcGVha1wiXSB9XSAqL1xuXG5pbXBvcnQgeyBjcmVhdGVTcGVlY2hSZWNvZ25pdGlvblBvbnlmaWxsRnJvbVJlY29nbml6ZXIgfSBmcm9tICd3ZWItc3BlZWNoLWNvZ25pdGl2ZS1zZXJ2aWNlcy9saWIvU3BlZWNoU2VydmljZXMvU3BlZWNoVG9UZXh0JztcblxuaW1wb3J0IEFib3J0Q29udHJvbGxlciBmcm9tICdhYm9ydC1jb250cm9sbGVyLWVzNSc7XG5pbXBvcnQgY3JlYXRlQ3VzdG9tRXZlbnQgZnJvbSAnLi9jcmVhdGVDdXN0b21FdmVudCc7XG5pbXBvcnQgY3JlYXRlRXJyb3JFdmVudCBmcm9tICcuL2NyZWF0ZUVycm9yRXZlbnQnO1xuaW1wb3J0IGNyZWF0ZVRhc2tRdWV1ZSBmcm9tICcuL2NyZWF0ZVRhc2tRdWV1ZSc7XG5pbXBvcnQgRXZlbnRUYXJnZXRTaGltLCB7IGRlZmluZUV2ZW50QXR0cmlidXRlIH0gZnJvbSAnZXZlbnQtdGFyZ2V0LXNoaW0tZXM1JztcbmltcG9ydCBwbGF5Q29nbml0aXZlU2VydmljZXNTdHJlYW0gZnJvbSAnLi9wbGF5Q29nbml0aXZlU2VydmljZXNTdHJlYW0nO1xuaW1wb3J0IHBsYXlXaGl0ZU5vaXNlIGZyb20gJy4vcGxheVdoaXRlTm9pc2UnO1xuaW1wb3J0IFNwZWVjaFN5bnRoZXNpc0F1ZGlvU3RyZWFtVXR0ZXJhbmNlIGZyb20gJy4vU3BlZWNoU3ludGhlc2lzQXVkaW9TdHJlYW1VdHRlcmFuY2UnO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbih7XG4gIGF1ZGlvQ29udGV4dCxcbiAgZW5hYmxlVGVsZW1ldHJ5LFxuICBwb255ZmlsbCA9IHtcbiAgICBBdWRpb0NvbnRleHQ6IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dFxuICB9LFxuICByZWNvZ25pemVyLFxuICB0ZXh0Tm9ybWFsaXphdGlvblxufSkge1xuICBpZiAoIXBvbnlmaWxsLkF1ZGlvQ29udGV4dCkge1xuICAgIGNvbnNvbGUud2FybihcbiAgICAgICdib3RmcmFtZXdvcmstZGlyZWN0bGluZXNwZWVjaC1zZGs6IFRoaXMgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IFdlYiBBdWRpbyBBUEkuIFNwZWVjaCBzdXBwb3J0IGlzIGRpc2FibGVkLidcbiAgICApO1xuXG4gICAgcmV0dXJuICgpID0+ICh7fSk7XG4gIH1cblxuICByZXR1cm4gKCkgPT4ge1xuICAgIGNvbnN0IHsgU3BlZWNoR3JhbW1hckxpc3QsIFNwZWVjaFJlY29nbml0aW9uIH0gPSBjcmVhdGVTcGVlY2hSZWNvZ25pdGlvblBvbnlmaWxsRnJvbVJlY29nbml6ZXIoe1xuICAgICAgY3JlYXRlUmVjb2duaXplcjogKCkgPT4gcmVjb2duaXplcixcbiAgICAgIGVuYWJsZVRlbGVtZXRyeSxcbiAgICAgIGxvb3NlRXZlbnRzOiB0cnVlLFxuICAgICAgdGV4dE5vcm1hbGl6YXRpb25cbiAgICB9KTtcblxuICAgIGlmICghYXVkaW9Db250ZXh0KSB7XG4gICAgICBhdWRpb0NvbnRleHQgPSBuZXcgcG9ueWZpbGwuQXVkaW9Db250ZXh0KCk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBjYW5jZWxBbGwsIHB1c2ggfSA9IGNyZWF0ZVRhc2tRdWV1ZSgpO1xuXG4gICAgY2xhc3MgU3BlZWNoU3ludGhlc2lzIGV4dGVuZHMgRXZlbnRUYXJnZXRTaGltIHtcbiAgICAgIGNhbmNlbCgpIHtcbiAgICAgICAgY2FuY2VsQWxsKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybnMgYW4gZW1wdHkgYXJyYXkuXG4gICAgICAvLyBTeW50aGVzaXMgaXMgZG9uZSBvbiB0aGUgYm90IHNpZGUsIHRoZSBjb250ZW50IG9mIHRoZSB2b2ljZSBsaXN0IGlzIG5vdCBtZWFuaW5nZnVsIG9uIHRoZSBjbGllbnQgc2lkZS5cbiAgICAgIGdldFZvaWNlcygpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuXG4gICAgICBzcGVhayh1dHRlcmFuY2UpIHtcbiAgICAgICAgY29uc3QgeyByZXN1bHQgfSA9IHB1c2goKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICAgICAgY29uc3QgeyBzaWduYWwgfSA9IGNvbnRyb2xsZXI7XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYWJvcnQ6IGNvbnRyb2xsZXIuYWJvcnQuYmluZChjb250cm9sbGVyKSxcbiAgICAgICAgICAgIHJlc3VsdDogKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgdXR0ZXJhbmNlLmRpc3BhdGNoRXZlbnQoY3JlYXRlQ3VzdG9tRXZlbnQoJ3N0YXJ0JykpO1xuXG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKHV0dGVyYW5jZS5hdWRpb1N0cmVhbSkge1xuICAgICAgICAgICAgICAgICAgYXdhaXQgcGxheUNvZ25pdGl2ZVNlcnZpY2VzU3RyZWFtKGF1ZGlvQ29udGV4dCwgdXR0ZXJhbmNlLmF1ZGlvU3RyZWFtLCB7IHNpZ25hbCB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgYXdhaXQgcGxheVdoaXRlTm9pc2UoYXVkaW9Db250ZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgLy8gRWl0aGVyIGRpc3BhdGNoIFwiZW5kXCIgb3IgXCJlcnJvclwiIGV2ZW50LCBidXQgbm90IGJvdGhcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IubWVzc2FnZSAhPT0gJ2Fib3J0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdXR0ZXJhbmNlLmRpc3BhdGNoRXZlbnQoY3JlYXRlRXJyb3JFdmVudChlcnJvcikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHV0dGVyYW5jZS5kaXNwYXRjaEV2ZW50KGNyZWF0ZUN1c3RvbUV2ZW50KCdlbmQnKSk7XG4gICAgICAgICAgICB9KSgpXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ2F0Y2hpbmcgdGhlIGVycm9yIHRvIHByZXZlbnQgdW5jYXVnaHQgcHJvbWlzZSBlcnJvciBkdWUgdG8gY2FuY2VsbGF0aW9uLlxuICAgICAgICByZXN1bHQuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIGlmICghL15jYW5jZWxsZWQvaXUudGVzdChlcnJvci5tZXNzYWdlKSkge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkZWZpbmVFdmVudEF0dHJpYnV0ZShTcGVlY2hTeW50aGVzaXMsICd2b2ljZXNjaGFuZ2VkJyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgU3BlZWNoR3JhbW1hckxpc3QsXG4gICAgICBTcGVlY2hSZWNvZ25pdGlvbixcbiAgICAgIHNwZWVjaFN5bnRoZXNpczogbmV3IFNwZWVjaFN5bnRoZXNpcygpLFxuICAgICAgU3BlZWNoU3ludGhlc2lzVXR0ZXJhbmNlOiBTcGVlY2hTeW50aGVzaXNBdWRpb1N0cmVhbVV0dGVyYW5jZVxuICAgIH07XG4gIH07XG59XG4iXX0=