"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _adaptivecards = require("adaptivecards");

function addCardAction(cardAction, includesOAuthButtons) {
  var type = cardAction.type;
  var action;

  if (type === 'imBack' || type === 'messageBack' || type === 'postBack' || type === 'signin' && includesOAuthButtons) {
    action = new _adaptivecards.SubmitAction();
    action.data = {
      __isBotFrameworkCardAction: true,
      cardAction: cardAction
    };
    action.title = cardAction.title;
  } else {
    action = new _adaptivecards.OpenUrlAction();
    action.title = cardAction.title;
    action.url = cardAction.type === 'call' ? "tel:".concat(cardAction.value) : cardAction.value;
  }

  return action;
}

var AdaptiveCardBuilder = /*#__PURE__*/function () {
  function AdaptiveCardBuilder(adaptiveCards, styleOptions) {
    var direction = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'ltr';
    (0, _classCallCheck2.default)(this, AdaptiveCardBuilder);
    (0, _defineProperty2.default)(this, "card", void 0);
    (0, _defineProperty2.default)(this, "container", void 0);
    (0, _defineProperty2.default)(this, "styleOptions", void 0);
    this.card = new adaptiveCards.AdaptiveCard();
    this.container = new _adaptivecards.Container();
    this.container.rtl = direction === 'rtl';
    this.styleOptions = styleOptions;
    this.card.addItem(this.container);
  }

  (0, _createClass2.default)(AdaptiveCardBuilder, [{
    key: "addColumnSet",
    value: function addColumnSet(sizes) {
      var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.container;
      var selectAction = arguments.length > 2 ? arguments[2] : undefined;
      var columnSet = new _adaptivecards.ColumnSet();
      columnSet.selectAction = selectAction && addCardAction(selectAction);
      container.addItem(columnSet);
      return sizes.map(function (size) {
        var column = new _adaptivecards.Column();
        column.width = _adaptivecards.SizeAndUnit.parse(size);
        columnSet.addColumn(column);
        return column;
      });
    }
  }, {
    key: "addItems",
    value: function addItems(cardElements) {
      var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.container;
      cardElements.forEach(function (cardElement) {
        return container.addItem(cardElement);
      });
    }
  }, {
    key: "addTextBlock",
    value: function addTextBlock(text, template) {
      var container = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.container;

      if (typeof text !== 'undefined') {
        var textblock = new _adaptivecards.TextBlock(); // tslint:disable-next-line:forin

        for (var prop in template) {
          textblock[prop] = template[prop];
        }

        textblock.text = text;
        container.addItem(textblock);
      }
    }
  }, {
    key: "addButtons",
    value: function addButtons(cardActions, includesOAuthButtons) {
      var _this = this;

      cardActions && cardActions.forEach(function (cardAction) {
        _this.card.addAction(addCardAction(cardAction, includesOAuthButtons));
      });
    }
  }, {
    key: "addCommonHeaders",
    value: function addCommonHeaders(content) {
      var richCardWrapTitle = this.styleOptions.richCardWrapTitle;
      this.addTextBlock(content.title, {
        color: _adaptivecards.TextColor.Dark,
        size: _adaptivecards.TextSize.Medium,
        weight: _adaptivecards.TextWeight.Bolder,
        wrap: richCardWrapTitle
      });
      this.addTextBlock(content.subtitle, {
        color: _adaptivecards.TextColor.Dark,
        isSubtle: true,
        wrap: richCardWrapTitle
      });
      this.addTextBlock(content.text, {
        color: _adaptivecards.TextColor.Dark,
        wrap: true
      });
    }
  }, {
    key: "addCommon",
    value: function addCommon(content) {
      this.addCommonHeaders(content);
      this.addButtons(content.buttons);
    }
  }, {
    key: "addImage",
    value: function addImage(url, container, selectAction, altText) {
      container = container || this.container;
      var image = new _adaptivecards.Image();
      image.altText = altText;
      image.url = url;
      image.selectAction = selectAction && addCardAction(selectAction);
      image.size = _adaptivecards.Size.Stretch;
      container.addItem(image);
    }
  }]);
  return AdaptiveCardBuilder;
}();

exports.default = AdaptiveCardBuilder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hZGFwdGl2ZUNhcmRzL0F0dGFjaG1lbnQvQWRhcHRpdmVDYXJkQnVpbGRlci50cyJdLCJuYW1lcyI6WyJhZGRDYXJkQWN0aW9uIiwiY2FyZEFjdGlvbiIsImluY2x1ZGVzT0F1dGhCdXR0b25zIiwidHlwZSIsImFjdGlvbiIsIlN1Ym1pdEFjdGlvbiIsImRhdGEiLCJfX2lzQm90RnJhbWV3b3JrQ2FyZEFjdGlvbiIsInRpdGxlIiwiT3BlblVybEFjdGlvbiIsInVybCIsInZhbHVlIiwiQWRhcHRpdmVDYXJkQnVpbGRlciIsImFkYXB0aXZlQ2FyZHMiLCJzdHlsZU9wdGlvbnMiLCJkaXJlY3Rpb24iLCJjYXJkIiwiQWRhcHRpdmVDYXJkIiwiY29udGFpbmVyIiwiQ29udGFpbmVyIiwicnRsIiwiYWRkSXRlbSIsInNpemVzIiwic2VsZWN0QWN0aW9uIiwiY29sdW1uU2V0IiwiQ29sdW1uU2V0IiwibWFwIiwic2l6ZSIsImNvbHVtbiIsIkNvbHVtbiIsIndpZHRoIiwiU2l6ZUFuZFVuaXQiLCJwYXJzZSIsImFkZENvbHVtbiIsImNhcmRFbGVtZW50cyIsImZvckVhY2giLCJjYXJkRWxlbWVudCIsInRleHQiLCJ0ZW1wbGF0ZSIsInRleHRibG9jayIsIlRleHRCbG9jayIsInByb3AiLCJjYXJkQWN0aW9ucyIsImFkZEFjdGlvbiIsImNvbnRlbnQiLCJyaWNoQ2FyZFdyYXBUaXRsZSIsImFkZFRleHRCbG9jayIsImNvbG9yIiwiVGV4dENvbG9yIiwiRGFyayIsIlRleHRTaXplIiwiTWVkaXVtIiwid2VpZ2h0IiwiVGV4dFdlaWdodCIsIkJvbGRlciIsIndyYXAiLCJzdWJ0aXRsZSIsImlzU3VidGxlIiwiYWRkQ29tbW9uSGVhZGVycyIsImFkZEJ1dHRvbnMiLCJidXR0b25zIiwiYWx0VGV4dCIsImltYWdlIiwiSW1hZ2UiLCJTaXplIiwiU3RyZXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBd0JBLFNBQVNBLGFB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ZCxPQUF0QjtBQUNBLFdBQUtlLFVBQUwsQ0FBZ0JmLE9BQU8sQ0FBQ2dCLE9BQXhCO0FBQ0Q7Ozs2QkFFUWxELEcsRUFBYVEsUyxFQUF1QkssWSxFQUEyQnNDLE8sRUFBa0I7QUFDeEYzQyxNQUFBQSxTQUFTLEdBQUdBLFNBQVMsSUFBSSxLQUFLQSxTQUE5QjtBQUVBLFVBQU00QyxLQUFLLEdBQUcsSUFBSUMsb0JBQUosRUFBZDtBQUVBRCxNQUFBQSxLQUFLLENBQUNELE9BQU4sR0FBZ0JBLE9BQWhCO0FBQ0FDLE1BQUFBLEtBQUssQ0FBQ3BELEdBQU4sR0FBWUEsR0FBWjtBQUNBb0QsTUFBQUEsS0FBSyxDQUFDdkMsWUFBTixHQUFxQkEsWUFBWSxJQUFJdkIsYUFBYSxDQUFDdUIsWUFBRCxDQUFsRDtBQUNBdUMsTUFBQUEsS0FBSyxDQUFDbkMsSUFBTixHQUFhcUMsb0JBQUtDLE9BQWxCO0FBRUEvQyxNQUFBQSxTQUFTLENBQUNHLE9BQVYsQ0FBa0J5QyxLQUFsQjtBQUNEIiwic291cmNlUm9vdCI6ImJ1bmRsZTovLy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZGFwdGl2ZUNhcmQsXG4gIENhcmRFbGVtZW50LFxuICBDb2x1bW4sXG4gIENvbHVtblNldCxcbiAgQ29udGFpbmVyLFxuICBJbWFnZSxcbiAgT3BlblVybEFjdGlvbixcbiAgU2l6ZSxcbiAgU2l6ZUFuZFVuaXQsXG4gIFN1Ym1pdEFjdGlvbixcbiAgVGV4dEJsb2NrLFxuICBUZXh0Q29sb3IsXG4gIFRleHRTaXplLFxuICBUZXh0V2VpZ2h0XG59IGZyb20gJ2FkYXB0aXZlY2FyZHMnO1xuXG5pbXBvcnQgeyBDYXJkQWN0aW9uIH0gZnJvbSAnYm90ZnJhbWV3b3JrLWRpcmVjdGxpbmVqcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQm90RnJhbWV3b3JrQ2FyZEFjdGlvbiB7XG4gIF9faXNCb3RGcmFtZXdvcmtDYXJkQWN0aW9uOiBib29sZWFuO1xuICBjYXJkQWN0aW9uOiBDYXJkQWN0aW9uO1xufVxuXG5mdW5jdGlvbiBhZGRDYXJkQWN0aW9uKGNhcmRBY3Rpb246IENhcmRBY3Rpb24sIGluY2x1ZGVzT0F1dGhCdXR0b25zPzogYm9vbGVhbikge1xuICBjb25zdCB7IHR5cGUgfSA9IGNhcmRBY3Rpb247XG4gIGxldCBhY3Rpb247XG5cbiAgaWYgKFxuICAgIHR5cGUgPT09ICdpbUJhY2snIHx8XG4gICAgdHlwZSA9PT0gJ21lc3NhZ2VCYWNrJyB8fFxuICAgIHR5cGUgPT09ICdwb3N0QmFjaycgfHxcbiAgICAodHlwZSA9PT0gJ3NpZ25pbicgJiYgaW5jbHVkZXNPQXV0aEJ1dHRvbnMpXG4gICkge1xuICAgIGFjdGlvbiA9IG5ldyBTdWJtaXRBY3Rpb24oKTtcblxuICAgIGFjdGlvbi5kYXRhID0ge1xuICAgICAgX19pc0JvdEZyYW1ld29ya0NhcmRBY3Rpb246IHRydWUsXG4gICAgICBjYXJkQWN0aW9uXG4gICAgfTtcblxuICAgIGFjdGlvbi50aXRsZSA9IGNhcmRBY3Rpb24udGl0bGU7XG4gIH0gZWxzZSB7XG4gICAgYWN0aW9uID0gbmV3IE9wZW5VcmxBY3Rpb24oKTtcblxuICAgIGFjdGlvbi50aXRsZSA9IGNhcmRBY3Rpb24udGl0bGU7XG4gICAgYWN0aW9uLnVybCA9IGNhcmRBY3Rpb24udHlwZSA9PT0gJ2NhbGwnID8gYHRlbDoke2NhcmRBY3Rpb24udmFsdWV9YCA6IGNhcmRBY3Rpb24udmFsdWU7XG4gIH1cblxuICByZXR1cm4gYWN0aW9uO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBZGFwdGl2ZUNhcmRCdWlsZGVyIHtcbiAgY2FyZDogQWRhcHRpdmVDYXJkO1xuICBjb250YWluZXI6IENvbnRhaW5lcjtcbiAgc3R5bGVPcHRpb25zOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoYWRhcHRpdmVDYXJkcywgc3R5bGVPcHRpb25zLCBkaXJlY3Rpb24gPSAnbHRyJykge1xuICAgIHRoaXMuY2FyZCA9IG5ldyBhZGFwdGl2ZUNhcmRzLkFkYXB0aXZlQ2FyZCgpO1xuICAgIHRoaXMuY29udGFpbmVyID0gbmV3IENvbnRhaW5lcigpO1xuICAgIHRoaXMuY29udGFpbmVyLnJ0bCA9IGRpcmVjdGlvbiA9PT0gJ3J0bCc7XG4gICAgdGhpcy5zdHlsZU9wdGlvbnMgPSBzdHlsZU9wdGlvbnM7XG5cbiAgICB0aGlzLmNhcmQuYWRkSXRlbSh0aGlzLmNvbnRhaW5lcik7XG4gIH1cblxuICBhZGRDb2x1bW5TZXQoc2l6ZXM6IG51bWJlcltdLCBjb250YWluZXI6IENvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyLCBzZWxlY3RBY3Rpb24/OiBDYXJkQWN0aW9uKSB7XG4gICAgY29uc3QgY29sdW1uU2V0ID0gbmV3IENvbHVtblNldCgpO1xuXG4gICAgY29sdW1uU2V0LnNlbGVjdEFjdGlvbiA9IHNlbGVjdEFjdGlvbiAmJiBhZGRDYXJkQWN0aW9uKHNlbGVjdEFjdGlvbik7XG4gICAgY29udGFpbmVyLmFkZEl0ZW0oY29sdW1uU2V0KTtcblxuICAgIHJldHVybiBzaXplcy5tYXAoc2l6ZSA9PiB7XG4gICAgICBjb25zdCBjb2x1bW4gPSBuZXcgQ29sdW1uKCk7XG5cbiAgICAgIGNvbHVtbi53aWR0aCA9IFNpemVBbmRVbml0LnBhcnNlKHNpemUpO1xuXG4gICAgICBjb2x1bW5TZXQuYWRkQ29sdW1uKGNvbHVtbik7XG5cbiAgICAgIHJldHVybiBjb2x1bW47XG4gICAgfSk7XG4gIH1cblxuICBhZGRJdGVtcyhjYXJkRWxlbWVudHM6IENhcmRFbGVtZW50W10sIGNvbnRhaW5lcjogQ29udGFpbmVyID0gdGhpcy5jb250YWluZXIpIHtcbiAgICBjYXJkRWxlbWVudHMuZm9yRWFjaChjYXJkRWxlbWVudCA9PiBjb250YWluZXIuYWRkSXRlbShjYXJkRWxlbWVudCkpO1xuICB9XG5cbiAgYWRkVGV4dEJsb2NrKHRleHQ6IHN0cmluZywgdGVtcGxhdGU6IFBhcnRpYWw8VGV4dEJsb2NrPiwgY29udGFpbmVyOiBDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcikge1xuICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGNvbnN0IHRleHRibG9jayA9IG5ldyBUZXh0QmxvY2soKTtcblxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmZvcmluXG4gICAgICBmb3IgKGNvbnN0IHByb3AgaW4gdGVtcGxhdGUpIHtcbiAgICAgICAgdGV4dGJsb2NrW3Byb3BdID0gdGVtcGxhdGVbcHJvcF07XG4gICAgICB9XG5cbiAgICAgIHRleHRibG9jay50ZXh0ID0gdGV4dDtcblxuICAgICAgY29udGFpbmVyLmFkZEl0ZW0odGV4dGJsb2NrKTtcbiAgICB9XG4gIH1cblxuICBhZGRCdXR0b25zKGNhcmRBY3Rpb25zOiBDYXJkQWN0aW9uW10sIGluY2x1ZGVzT0F1dGhCdXR0b25zPzogYm9vbGVhbikge1xuICAgIGNhcmRBY3Rpb25zICYmXG4gICAgICBjYXJkQWN0aW9ucy5mb3JFYWNoKGNhcmRBY3Rpb24gPT4ge1xuICAgICAgICB0aGlzLmNhcmQuYWRkQWN0aW9uKGFkZENhcmRBY3Rpb24oY2FyZEFjdGlvbiwgaW5jbHVkZXNPQXV0aEJ1dHRvbnMpKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgYWRkQ29tbW9uSGVhZGVycyhjb250ZW50OiBJQ29tbW9uQ29udGVudCkge1xuICAgIGNvbnN0IHsgcmljaENhcmRXcmFwVGl0bGUgfSA9IHRoaXMuc3R5bGVPcHRpb25zO1xuICAgIHRoaXMuYWRkVGV4dEJsb2NrKGNvbnRlbnQudGl0bGUsIHtcbiAgICAgIGNvbG9yOiBUZXh0Q29sb3IuRGFyayxcbiAgICAgIHNpemU6IFRleHRTaXplLk1lZGl1bSxcbiAgICAgIHdlaWdodDogVGV4dFdlaWdodC5Cb2xkZXIsXG4gICAgICB3cmFwOiByaWNoQ2FyZFdyYXBUaXRsZVxuICAgIH0pO1xuICAgIHRoaXMuYWRkVGV4dEJsb2NrKGNvbnRlbnQuc3VidGl0bGUsIHsgY29sb3I6IFRleHRDb2xvci5EYXJrLCBpc1N1YnRsZTogdHJ1ZSwgd3JhcDogcmljaENhcmRXcmFwVGl0bGUgfSk7XG4gICAgdGhpcy5hZGRUZXh0QmxvY2soY29udGVudC50ZXh0LCB7IGNvbG9yOiBUZXh0Q29sb3IuRGFyaywgd3JhcDogdHJ1ZSB9KTtcbiAgfVxuXG4gIGFkZENvbW1vbihjb250ZW50OiBJQ29tbW9uQ29udGVudCkge1xuICAgIHRoaXMuYWRkQ29tbW9uSGVhZGVycyhjb250ZW50KTtcbiAgICB0aGlzLmFkZEJ1dHRvbnMoY29udGVudC5idXR0b25zKTtcbiAgfVxuXG4gIGFkZEltYWdlKHVybDogc3RyaW5nLCBjb250YWluZXI/OiBDb250YWluZXIsIHNlbGVjdEFjdGlvbj86IENhcmRBY3Rpb24sIGFsdFRleHQ/OiBzdHJpbmcpIHtcbiAgICBjb250YWluZXIgPSBjb250YWluZXIgfHwgdGhpcy5jb250YWluZXI7XG5cbiAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuXG4gICAgaW1hZ2UuYWx0VGV4dCA9IGFsdFRleHQ7XG4gICAgaW1hZ2UudXJsID0gdXJsO1xuICAgIGltYWdlLnNlbGVjdEFjdGlvbiA9IHNlbGVjdEFjdGlvbiAmJiBhZGRDYXJkQWN0aW9uKHNlbGVjdEFjdGlvbik7XG4gICAgaW1hZ2Uuc2l6ZSA9IFNpemUuU3RyZXRjaDtcblxuICAgIGNvbnRhaW5lci5hZGRJdGVtKGltYWdlKTtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElDb21tb25Db250ZW50IHtcbiAgYnV0dG9ucz86IENhcmRBY3Rpb25bXTtcbiAgc3VidGl0bGU/OiBzdHJpbmc7XG4gIHRleHQ/OiBzdHJpbmc7XG4gIHRpdGxlPzogc3RyaW5nO1xufVxuIl19