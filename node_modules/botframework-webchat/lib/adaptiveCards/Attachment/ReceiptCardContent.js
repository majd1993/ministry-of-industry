"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _toArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _botframeworkWebchatComponent = require("botframework-webchat-component");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireWildcard(require("react"));

var _AdaptiveCardBuilder = _interopRequireDefault(require("./AdaptiveCardBuilder"));

var _AdaptiveCardRenderer = _interopRequireDefault(require("./AdaptiveCardRenderer"));

var _useAdaptiveCardsPackage = _interopRequireDefault(require("../hooks/useAdaptiveCardsPackage"));

/* eslint no-magic-numbers: ["error", { "ignore": [0, 1, 10, 15, 25, 50, 75] }] */
var useDirection = _botframeworkWebchatComponent.hooks.useDirection,
    useLocalizer = _botframeworkWebchatComponent.hooks.useLocalizer,
    useStyleOptions = _botframeworkWebchatComponent.hooks.useStyleOptions;

function nullOrUndefined(obj) {
  return obj === null || typeof obj === 'undefined';
}

var ReceiptCardContent = function ReceiptCardContent(_ref) {
  var actionPerformedClassName = _ref.actionPerformedClassName,
      content = _ref.content,
      disabled = _ref.disabled;

  var _useAdaptiveCardsPack = (0, _useAdaptiveCardsPackage.default)(),
      _useAdaptiveCardsPack2 = (0, _slicedToArray2.default)(_useAdaptiveCardsPack, 1),
      adaptiveCardsPackage = _useAdaptiveCardsPack2[0];

  var _useDirection = useDirection(),
      _useDirection2 = (0, _slicedToArray2.default)(_useDirection, 1),
      direction = _useDirection2[0];

  var _useStyleOptions = useStyleOptions(),
      _useStyleOptions2 = (0, _slicedToArray2.default)(_useStyleOptions, 1),
      styleOptions = _useStyleOptions2[0];

  var localize = useLocalizer();
  var taxText = localize('RECEIPT_CARD_TAX');
  var totalText = localize('RECEIPT_CARD_TOTAL');
  var vatText = localize('RECEIPT_CARD_VAT');
  var builtCard = (0, _react.useMemo)(function () {
    var builder = new _AdaptiveCardBuilder.default(adaptiveCardsPackage, styleOptions, direction);
    var HorizontalAlignment = adaptiveCardsPackage.HorizontalAlignment,
        TextSize = adaptiveCardsPackage.TextSize,
        TextWeight = adaptiveCardsPackage.TextWeight;
    var buttons = content.buttons,
        facts = content.facts,
        items = content.items,
        tax = content.tax,
        title = content.title,
        total = content.total,
        vat = content.vat;
    var richCardWrapTitle = styleOptions.richCardWrapTitle;

    if (content) {
      builder.addTextBlock(title, {
        size: TextSize.Medium,
        weight: TextWeight.Bolder,
        wrap: richCardWrapTitle
      });

      if (facts) {
        var _builder$addColumnSet = builder.addColumnSet([75, 25]),
            _builder$addColumnSet2 = (0, _slicedToArray2.default)(_builder$addColumnSet, 2),
            firstFactColumn = _builder$addColumnSet2[0],
            lastFactColumn = _builder$addColumnSet2[1];

        facts.map(function (_ref2) {
          var key = _ref2.key,
              value = _ref2.value;
          builder.addTextBlock(key, {
            size: TextSize.Medium
          }, firstFactColumn);
          builder.addTextBlock(value, {
            size: TextSize.Medium,
            horizontalAlignment: HorizontalAlignment.Right
          }, lastFactColumn);
        });
      }

      items && items.map(function (_ref3) {
        var _ref3$image = _ref3.image;
        _ref3$image = _ref3$image === void 0 ? {} : _ref3$image;
        var alt = _ref3$image.alt,
            imageTap = _ref3$image.tap,
            url = _ref3$image.url,
            price = _ref3.price,
            quantity = _ref3.quantity,
            subtitle = _ref3.subtitle,
            tap = _ref3.tap,
            text = _ref3.text,
            title = _ref3.title;
        var itemColumns;

        if (url) {
          var _builder$addColumnSet3 = builder.addColumnSet([15, 75, 10]),
              _builder$addColumnSet4 = (0, _toArray2.default)(_builder$addColumnSet3),
              itemImageColumn = _builder$addColumnSet4[0],
              columns = _builder$addColumnSet4.slice(1);

          itemColumns = columns;
          builder.addImage(url, itemImageColumn, imageTap, alt);
        } else {
          itemColumns = builder.addColumnSet([75, 25], undefined, tap && tap);
        }

        var _itemColumns = itemColumns,
            _itemColumns2 = (0, _slicedToArray2.default)(_itemColumns, 2),
            itemTitleColumn = _itemColumns2[0],
            itemPriceColumn = _itemColumns2[1];

        builder.addTextBlock(quantity ? "".concat(title, " &times; ").concat(quantity) : title, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder,
          wrap: richCardWrapTitle
        }, itemTitleColumn);
        builder.addTextBlock(subtitle, {
          size: TextSize.Medium,
          wrap: richCardWrapTitle
        }, itemTitleColumn);
        builder.addTextBlock(price, {
          horizontalAlignment: HorizontalAlignment.Right
        }, itemPriceColumn);

        if (text) {
          builder.addTextBlock(text, {
            size: TextSize.Medium,
            wrap: richCardWrapTitle
          }, itemTitleColumn);
        }
      });

      if (!nullOrUndefined(vat)) {
        var vatCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock(vatText, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, vatCol[0]);
        builder.addTextBlock(vat, {
          horizontalAlignment: HorizontalAlignment.Right
        }, vatCol[1]);
      }

      if (!nullOrUndefined(tax)) {
        var taxCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock(taxText, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, taxCol[0]);
        builder.addTextBlock(tax, {
          horizontalAlignment: HorizontalAlignment.Right
        }, taxCol[1]);
      }

      if (!nullOrUndefined(total)) {
        var totalCol = builder.addColumnSet([75, 25]);
        builder.addTextBlock(totalText, {
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, totalCol[0]);
        builder.addTextBlock(total, {
          horizontalAlignment: HorizontalAlignment.Right,
          size: TextSize.Medium,
          weight: TextWeight.Bolder
        }, totalCol[1]);
      }

      builder.addButtons(buttons);
      return builder.card;
    }
  }, [adaptiveCardsPackage, content, direction, styleOptions, taxText, totalText, vatText]);
  return /*#__PURE__*/_react.default.createElement(_AdaptiveCardRenderer.default, {
    actionPerformedClassName: actionPerformedClassName,
    adaptiveCard: builtCard,
    disabled: disabled,
    tapAction: content && content.tap
  });
};

ReceiptCardContent.defaultProps = {
  actionPerformedClassName: '',
  disabled: undefined
};
ReceiptCardContent.propTypes = {
  actionPerformedClassName: _propTypes.default.string,
  content: _propTypes.default.shape({
    buttons: _propTypes.default.array,
    facts: _propTypes.default.arrayOf(_propTypes.default.shape({
      key: _propTypes.default.string,
      value: _propTypes.default.string
    })),
    items: _propTypes.default.arrayOf(_propTypes.default.shape({
      image: _propTypes.default.shape({
        alt: _propTypes.default.string.isRequired,
        tap: _propTypes.default.any,
        url: _propTypes.default.string.isRequired
      }),
      price: _propTypes.default.string.isRequired,
      quantity: _propTypes.default.string,
      subtitle: _propTypes.default.string,
      tap: _propTypes.default.any,
      text: _propTypes.default.string,
      title: _propTypes.default.string.isRequired
    })),
    tap: _propTypes.default.any,
    tax: _propTypes.default.string,
    title: _propTypes.default.string,
    total: _propTypes.default.string,
    vat: _propTypes.default.string
  }).isRequired,
  disabled: _propTypes.default.bool
};
var _default = ReceiptCardContent;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hZGFwdGl2ZUNhcmRzL0F0dGFjaG1lbnQvUmVjZWlwdENhcmRDb250ZW50LmpzIl0sIm5hbWVzIjpbInVzZURpcmVjdGlvbiIsImhvb2tzIiwidXNlTG9jYWxpemVyIiwidXNlU3R5bGVPcHRpb25zIiwibnVsbE9yVW5kZWZpbmVkIiwib2JqIiwiUmVjZWlwdENhcmRDb250ZW50IiwiYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lIiwiY29udGVudCIsImRpc2FibGVkIiwiYWRhcHRpdmVDYXJkc1BhY2thZ2UiLCJkaXJlY3Rpb24iLCJzdHlsZU9wdGlvbnMiLCJsb2NhbGl6ZSIsInRheFRleHQiLCJ0b3RhbFRleHQiLCJ2YXRUZXh0IiwiYnVpbHRDYXJkIiwiYnVpbGRlciIsIkFkYXB0aXZlQ2FyZEJ1aWxkZXIiLCJIb3Jpem9udGFsQWxpZ25tZW50IiwiVGV4dFNpemUiLCJUZXh0V2VpZ2h0IiwiYnV0dG9ucyIsImZhY3RzIiwiaXRlbXMiLCJ0YXgiLCJ0aXRsZSIsInRvdGFsIiwidmF0IiwicmljaENhcmRXcmFwVGl0bGUiLCJhZGRUZXh0QmxvY2siLCJzaXplIiwiTWVkaXVtIiwid2VpZ2h0IiwiQm9sZGVyIiwid3JhcCIsImFkZENvbHVtblNldCIsImZpcnN0RmFjdENvbHVtbiIsImxhc3RGYWN0Q29sdW1uIiwibWFwIiwia2V5IiwidmFsdWUiLCJob3Jpem9udGFsQWxpZ25tZW50IiwiUmlnaHQiLCJpbWFnZSIsImFsdCIsImltYWdlVGFwIiwidGFwIiwidXJsIiwicHJpY2UiLCJxdWFudGl0eSIsInN1YnRpdGxlIiwidGV4dCIsIml0ZW1Db2x1bW5zIiwiaXRlbUltYWdlQ29sdW1uIiwiY29sdW1ucyIsImFkZEltYWdlIiwidW5kZWZpbmVkIiwiaXRlbVRpdGxlQ29sdW1uIiwiaXRlbVByaWNlQ29sdW1uIiwidmF0Q29sIiwidGF4Q29sIiwidG90YWxDb2wiLCJhZGRCdXR0b25zIiwiY2FyZCIsImRlZmF1bHRQcm9wcyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInN0cmluZyIsInNoYXBlIiwiYXJyYXkiLCJhcnJheU9mIiwiaXNSZXF1aXJlZCIsImFueSIsImJvb2wiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUVBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQVJBO0lBVVFBLFksR0FBZ0RDLG1DLENBQWhERCxZO0lBQWNFLFksR0FBa0NELG1DLENBQWxDQyxZO0lBQWNDLGUsR0FBb0JGLG1DLENBQXBCRSxlOztBQUVwQyxTQUFTQyxlQUFULENBQXlCQyxHQUF6QixFQUE4QjtBQUM1QixTQUFPQSxHQUFHLEtBQUssSUFBUixJQUFnQixPQUFPQSxHQUFQLEtBQWUsV0FBdEM7QUFDRDs7QUFFRCxJQUFNQyxrQkFBa0IsR0FBRyxTQUFyQkEsa0JBQXFCLE9BQXFEO0FBQUEsTUFBbERDLHdCQUFrRCxRQUFsREEsd0JBQWtEO0FBQUEsTUFBeEJDLE9BQXdCLFFBQXhCQSxPQUF3QjtBQUFBLE1BQWZDLFFBQWUsUUFBZkEsUUFBZTs7QUFBQSw4QkFDL0MsdUNBRCtDO0FBQUE7QUFBQSxNQUN2RUMsb0JBRHVFOztBQUFBLHNCQUUxRFYsWUFBWSxFQUY4QztBQUFBO0FBQUEsTUFFdkVXLFNBRnVFOztBQUFBLHlCQUd2RFIsZUFBZSxFQUh3QztBQUFBO0FBQUEsTUFHdkVTLFlBSHVFOztBQUk5RSxNQUFNQyxRQUFRLEdBQUdYLFlBQVksRUFBN0I7QUFFQSxNQUFNWSxPQUFPLEdBQUdELFFBQVEsQ0FBQyxrQkFBRCxDQUF4QjtBQUNBLE1BQU1FLFNBQVMsR0FBR0YsUUFBUSxDQUFDLG9CQUFELENBQTFCO0FBQ0EsTUFBTUcsT0FBTyxHQUFHSCxRQUFRLENBQUMsa0JBQUQsQ0FBeEI7QUFFQSxNQUFNSSxTQUFTLEdBQUcsb0JBQVEsWUFBTTtBQUM5QixRQUFNQyxPQUFPLEdBQUcsSUFBSUMsNEJBQUosQ0FBd0JULG9CQUF4QixFQUE4Q0UsWUFBOUMsRUFBNERELFNBQTVELENBQWhCO0FBRDhCLFFBRXRCUyxtQkFG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QyxNQXpCTTtBQTBCdkJ6QyxJQUFBQSxLQUFLLEVBQUV3QyxtQkFBVUMsTUExQk07QUEyQnZCeEMsSUFBQUEsR0FBRyxFQUFFdUMsbUJBQVVDO0FBM0JRLEdBQWhCLEVBNEJOSSxVQTlCMEI7QUErQjdCaEUsRUFBQUEsUUFBUSxFQUFFMkQsbUJBQVVPO0FBL0JTLENBQS9CO2VBa0NlckUsa0IiLCJzb3VyY2VSb290IjoiYnVuZGxlOi8vLyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludCBuby1tYWdpYy1udW1iZXJzOiBbXCJlcnJvclwiLCB7IFwiaWdub3JlXCI6IFswLCAxLCAxMCwgMTUsIDI1LCA1MCwgNzVdIH1dICovXG5cbmltcG9ydCB7IGhvb2tzIH0gZnJvbSAnYm90ZnJhbWV3b3JrLXdlYmNoYXQtY29tcG9uZW50JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QsIHsgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IEFkYXB0aXZlQ2FyZEJ1aWxkZXIgZnJvbSAnLi9BZGFwdGl2ZUNhcmRCdWlsZGVyJztcbmltcG9ydCBBZGFwdGl2ZUNhcmRSZW5kZXJlciBmcm9tICcuL0FkYXB0aXZlQ2FyZFJlbmRlcmVyJztcbmltcG9ydCB1c2VBZGFwdGl2ZUNhcmRzUGFja2FnZSBmcm9tICcuLi9ob29rcy91c2VBZGFwdGl2ZUNhcmRzUGFja2FnZSc7XG5cbmNvbnN0IHsgdXNlRGlyZWN0aW9uLCB1c2VMb2NhbGl6ZXIsIHVzZVN0eWxlT3B0aW9ucyB9ID0gaG9va3M7XG5cbmZ1bmN0aW9uIG51bGxPclVuZGVmaW5lZChvYmopIHtcbiAgcmV0dXJuIG9iaiA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqID09PSAndW5kZWZpbmVkJztcbn1cblxuY29uc3QgUmVjZWlwdENhcmRDb250ZW50ID0gKHsgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lLCBjb250ZW50LCBkaXNhYmxlZCB9KSA9PiB7XG4gIGNvbnN0IFthZGFwdGl2ZUNhcmRzUGFja2FnZV0gPSB1c2VBZGFwdGl2ZUNhcmRzUGFja2FnZSgpO1xuICBjb25zdCBbZGlyZWN0aW9uXSA9IHVzZURpcmVjdGlvbigpO1xuICBjb25zdCBbc3R5bGVPcHRpb25zXSA9IHVzZVN0eWxlT3B0aW9ucygpO1xuICBjb25zdCBsb2NhbGl6ZSA9IHVzZUxvY2FsaXplcigpO1xuXG4gIGNvbnN0IHRheFRleHQgPSBsb2NhbGl6ZSgnUkVDRUlQVF9DQVJEX1RBWCcpO1xuICBjb25zdCB0b3RhbFRleHQgPSBsb2NhbGl6ZSgnUkVDRUlQVF9DQVJEX1RPVEFMJyk7XG4gIGNvbnN0IHZhdFRleHQgPSBsb2NhbGl6ZSgnUkVDRUlQVF9DQVJEX1ZBVCcpO1xuXG4gIGNvbnN0IGJ1aWx0Q2FyZCA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgQWRhcHRpdmVDYXJkQnVpbGRlcihhZGFwdGl2ZUNhcmRzUGFja2FnZSwgc3R5bGVPcHRpb25zLCBkaXJlY3Rpb24pO1xuICAgIGNvbnN0IHsgSG9yaXpvbnRhbEFsaWdubWVudCwgVGV4dFNpemUsIFRleHRXZWlnaHQgfSA9IGFkYXB0aXZlQ2FyZHNQYWNrYWdlO1xuICAgIGNvbnN0IHsgYnV0dG9ucywgZmFjdHMsIGl0ZW1zLCB0YXgsIHRpdGxlLCB0b3RhbCwgdmF0IH0gPSBjb250ZW50O1xuICAgIGNvbnN0IHsgcmljaENhcmRXcmFwVGl0bGUgfSA9IHN0eWxlT3B0aW9ucztcblxuICAgIGlmIChjb250ZW50KSB7XG4gICAgICBidWlsZGVyLmFkZFRleHRCbG9jayh0aXRsZSwgeyBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sIHdlaWdodDogVGV4dFdlaWdodC5Cb2xkZXIsIHdyYXA6IHJpY2hDYXJkV3JhcFRpdGxlIH0pO1xuXG4gICAgICBpZiAoZmFjdHMpIHtcbiAgICAgICAgY29uc3QgW2ZpcnN0RmFjdENvbHVtbiwgbGFzdEZhY3RDb2x1bW5dID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgIGZhY3RzLm1hcCgoeyBrZXksIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhrZXksIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtIH0sIGZpcnN0RmFjdENvbHVtbik7XG4gICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soXG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sXG4gICAgICAgICAgICBsYXN0RmFjdENvbHVtblxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpdGVtcyAmJlxuICAgICAgICBpdGVtcy5tYXAoKHsgaW1hZ2U6IHsgYWx0LCB0YXA6IGltYWdlVGFwLCB1cmwgfSA9IHt9LCBwcmljZSwgcXVhbnRpdHksIHN1YnRpdGxlLCB0YXAsIHRleHQsIHRpdGxlIH0pID0+IHtcbiAgICAgICAgICBsZXQgaXRlbUNvbHVtbnM7XG5cbiAgICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgICBjb25zdCBbaXRlbUltYWdlQ29sdW1uLCAuLi5jb2x1bW5zXSA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFsxNSwgNzUsIDEwXSk7XG5cbiAgICAgICAgICAgIGl0ZW1Db2x1bW5zID0gY29sdW1ucztcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkSW1hZ2UodXJsLCBpdGVtSW1hZ2VDb2x1bW4sIGltYWdlVGFwLCBhbHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtQ29sdW1ucyA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFs3NSwgMjVdLCB1bmRlZmluZWQsIHRhcCAmJiB0YXApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IFtpdGVtVGl0bGVDb2x1bW4sIGl0ZW1QcmljZUNvbHVtbl0gPSBpdGVtQ29sdW1ucztcblxuICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKFxuICAgICAgICAgICAgcXVhbnRpdHkgPyBgJHt0aXRsZX0gJnRpbWVzOyAke3F1YW50aXR5fWAgOiB0aXRsZSxcbiAgICAgICAgICAgIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyLCB3cmFwOiByaWNoQ2FyZFdyYXBUaXRsZSB9LFxuICAgICAgICAgICAgaXRlbVRpdGxlQ29sdW1uXG4gICAgICAgICAgKTtcbiAgICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayhzdWJ0aXRsZSwgeyBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sIHdyYXA6IHJpY2hDYXJkV3JhcFRpdGxlIH0sIGl0ZW1UaXRsZUNvbHVtbik7XG4gICAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2socHJpY2UsIHsgaG9yaXpvbnRhbEFsaWdubWVudDogSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodCB9LCBpdGVtUHJpY2VDb2x1bW4pO1xuXG4gICAgICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHRleHQsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3cmFwOiByaWNoQ2FyZFdyYXBUaXRsZSB9LCBpdGVtVGl0bGVDb2x1bW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIGlmICghbnVsbE9yVW5kZWZpbmVkKHZhdCkpIHtcbiAgICAgICAgY29uc3QgdmF0Q29sID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHZhdFRleHQsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sIHZhdENvbFswXSk7XG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHZhdCwgeyBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sIHZhdENvbFsxXSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghbnVsbE9yVW5kZWZpbmVkKHRheCkpIHtcbiAgICAgICAgY29uc3QgdGF4Q29sID0gYnVpbGRlci5hZGRDb2x1bW5TZXQoWzc1LCAyNV0pO1xuXG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHRheFRleHQsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sIHRheENvbFswXSk7XG4gICAgICAgIGJ1aWxkZXIuYWRkVGV4dEJsb2NrKHRheCwgeyBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0IH0sIHRheENvbFsxXSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghbnVsbE9yVW5kZWZpbmVkKHRvdGFsKSkge1xuICAgICAgICBjb25zdCB0b3RhbENvbCA9IGJ1aWxkZXIuYWRkQ29sdW1uU2V0KFs3NSwgMjVdKTtcblxuICAgICAgICBidWlsZGVyLmFkZFRleHRCbG9jayh0b3RhbFRleHQsIHsgc2l6ZTogVGV4dFNpemUuTWVkaXVtLCB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyIH0sIHRvdGFsQ29sWzBdKTtcbiAgICAgICAgYnVpbGRlci5hZGRUZXh0QmxvY2soXG4gICAgICAgICAgdG90YWwsXG4gICAgICAgICAgeyBob3Jpem9udGFsQWxpZ25tZW50OiBIb3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0LCBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sIHdlaWdodDogVGV4dFdlaWdodC5Cb2xkZXIgfSxcbiAgICAgICAgICB0b3RhbENvbFsxXVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBidWlsZGVyLmFkZEJ1dHRvbnMoYnV0dG9ucyk7XG5cbiAgICAgIHJldHVybiBidWlsZGVyLmNhcmQ7XG4gICAgfVxuICB9LCBbYWRhcHRpdmVDYXJkc1BhY2thZ2UsIGNvbnRlbnQsIGRpcmVjdGlvbiwgc3R5bGVPcHRpb25zLCB0YXhUZXh0LCB0b3RhbFRleHQsIHZhdFRleHRdKTtcblxuICByZXR1cm4gKFxuICAgIDxBZGFwdGl2ZUNhcmRSZW5kZXJlclxuICAgICAgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lPXthY3Rpb25QZXJmb3JtZWRDbGFzc05hbWV9XG4gICAgICBhZGFwdGl2ZUNhcmQ9e2J1aWx0Q2FyZH1cbiAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH1cbiAgICAgIHRhcEFjdGlvbj17Y29udGVudCAmJiBjb250ZW50LnRhcH1cbiAgICAvPlxuICApO1xufTtcblxuUmVjZWlwdENhcmRDb250ZW50LmRlZmF1bHRQcm9wcyA9IHtcbiAgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lOiAnJyxcbiAgZGlzYWJsZWQ6IHVuZGVmaW5lZFxufTtcblxuUmVjZWlwdENhcmRDb250ZW50LnByb3BUeXBlcyA9IHtcbiAgYWN0aW9uUGVyZm9ybWVkQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBjb250ZW50OiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgIGJ1dHRvbnM6IFByb3BUeXBlcy5hcnJheSxcbiAgICBmYWN0czogUHJvcFR5cGVzLmFycmF5T2YoXG4gICAgICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgICBrZXk6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nXG4gICAgICB9KVxuICAgICksXG4gICAgaXRlbXM6IFByb3BUeXBlcy5hcnJheU9mKFxuICAgICAgUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgICAgaW1hZ2U6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICAgICAgYWx0OiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgICAgdGFwOiBQcm9wVHlwZXMuYW55LFxuICAgICAgICAgIHVybDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkXG4gICAgICAgIH0pLFxuICAgICAgICBwcmljZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgICBxdWFudGl0eTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgc3VidGl0bGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIHRhcDogUHJvcFR5cGVzLmFueSxcbiAgICAgICAgdGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZFxuICAgICAgfSlcbiAgICApLFxuICAgIHRhcDogUHJvcFR5cGVzLmFueSxcbiAgICB0YXg6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdGl0bGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdG90YWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdmF0OiBQcm9wVHlwZXMuc3RyaW5nXG4gIH0pLmlzUmVxdWlyZWQsXG4gIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbFxufTtcblxuZXhwb3J0IGRlZmF1bHQgUmVjZWlwdENhcmRDb250ZW50O1xuIl19